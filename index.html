<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
<title>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø­ÙØ¸ Ø¬Ø²Ø¡ Ø¹Ù… ğŸŒ™</title>
<link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet"/>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
  --g:#0e4d3a;--g2:#176049;--g3:#1e7a5c;
  --gold:#c8982a;--gold2:#e8b84b;--gold3:#fde68a;
  --cream:#fdf8ee;--cream2:#f7f0dc;
  --ink:#1a1a1a;--muted:#7a8a90;--border:#e2d9c8;
  --red:#e74c3c;--white:#fff;
  --sh:0 4px 20px rgba(0,0,0,0.10);
  --sh2:0 8px 32px rgba(0,0,0,0.15);
}
html,body{min-height:100vh;background:var(--cream);}
body{font-family:'Tajawal',sans-serif;color:var(--ink);overflow-x:hidden;}

/* â”€â”€ TOPBAR â”€â”€ */
#topbar{
  position:sticky;top:0;z-index:200;
  background:linear-gradient(135deg,var(--g),var(--g2));
  height:58px;display:flex;align-items:center;
  padding:0 14px;gap:10px;
  box-shadow:0 2px 16px rgba(14,77,58,.4);
}
.tb-logo{
  width:38px;height:38px;border-radius:50%;overflow:hidden;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  display:flex;align-items:center;justify-content:center;
  font-size:1.3rem;flex-shrink:0;
  border:2px solid rgba(255,255,255,.3);
}
.tb-logo img{width:100%;height:100%;object-fit:cover;}
.tb-info{flex:1;min-width:0;}
.tb-title{color:#fff;font-family:'Scheherazade New',serif;font-size:1rem;font-weight:700;line-height:1.2;}
.tb-sub{color:var(--gold3);font-size:0.7rem;}
#tbActions{display:flex;gap:6px;align-items:center;flex-shrink:0;}
.tb-btn{
  background:rgba(255,255,255,.15);color:#fff;
  border:1.5px solid rgba(255,255,255,.25);
  padding:7px 12px;border-radius:20px;
  font-size:0.82rem;font-weight:700;cursor:pointer;
  font-family:'Tajawal',sans-serif;
  transition:background .2s;white-space:nowrap;
}
.tb-btn:hover{background:rgba(255,255,255,.25);}
.tb-btn.gold{background:linear-gradient(135deg,var(--gold),var(--gold2));color:var(--g);border-color:transparent;}

/* â”€â”€ MAIN â”€â”€ */
#main{max-width:520px;margin:0 auto;padding:16px 12px 60px;}

/* â”€â”€ PAGES â”€â”€ */
.pg{display:none;}
.pg.on{display:block;}

/* â”€â”€ CARDS â”€â”€ */
.card{background:var(--white);border-radius:16px;border:1.5px solid var(--border);padding:18px 16px;box-shadow:var(--sh);margin-bottom:12px;}
.card-title{font-size:1.1rem;font-weight:700;color:var(--g);margin-bottom:16px;display:flex;align-items:center;gap:8px;}

/* â”€â”€ HERO â”€â”€ */
.hero{text-align:center;padding:24px 8px 20px;}
.hero-icon{font-size:3.8rem;display:block;animation:float 3.5s ease-in-out infinite;}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.hero h1{font-family:'Scheherazade New',serif;font-size:1.8rem;color:var(--g);margin:8px 0 4px;}
.hero p{color:var(--muted);font-size:0.9rem;}
.hero-badge{
  display:inline-flex;align-items:center;gap:6px;margin:10px auto 22px;
  background:linear-gradient(135deg,#fef9ec,#fdf0c0);
  border:1.5px solid var(--gold);border-radius:20px;
  padding:5px 16px;color:var(--gold);font-weight:700;font-size:0.82rem;
}

/* â”€â”€ HOME CARDS â”€â”€ */
.home-btn{
  display:flex;align-items:center;gap:14px;
  background:var(--white);border:2px solid var(--border);
  border-radius:16px;padding:16px 18px;margin-bottom:10px;
  cursor:pointer;transition:all .22s;text-align:right;width:100%;
  box-shadow:0 2px 8px rgba(0,0,0,.05);
}
.home-btn:hover,.home-btn:active{border-color:var(--g);box-shadow:var(--sh);transform:translateY(-2px);}
.home-btn .hb-icon{
  width:50px;height:50px;border-radius:14px;
  background:linear-gradient(135deg,var(--cream),var(--cream2));
  display:flex;align-items:center;justify-content:center;
  font-size:1.6rem;flex-shrink:0;
}
.home-btn .hb-info{flex:1;}
.home-btn .hb-title{font-weight:700;font-size:1rem;color:var(--g);}
.home-btn .hb-desc{font-size:0.78rem;color:var(--muted);margin-top:2px;}
.home-btn .hb-arr{color:var(--muted);font-size:1rem;}
.home-btn.dashed{border-style:dashed;}

/* â”€â”€ FORMS â”€â”€ */
.f-group{margin-bottom:14px;}
.f-label{display:block;font-weight:700;font-size:0.92rem;color:var(--g);margin-bottom:7px;}
.f-input{
  width:100%;padding:13px 14px;font-size:1rem;
  font-family:'Tajawal',sans-serif;
  border:2px solid var(--border);border-radius:12px;
  background:var(--cream);color:var(--ink);
  transition:all .2s;
}
.f-input:focus{outline:none;border-color:var(--gold);background:#fff;box-shadow:0 0 0 4px rgba(200,152,42,.12);}
.pw-wrap{position:relative;}
.pw-eye{position:absolute;left:12px;top:50%;transform:translateY(-50%);font-size:1.1rem;cursor:pointer;color:var(--muted);}
.err-box{background:#fef2f2;color:#991b1b;padding:11px 14px;border-radius:10px;margin-bottom:12px;font-size:0.88rem;font-weight:600;border:1.5px solid #fecaca;display:none;}
.err-box.on{display:block;}
.back-lnk{display:flex;align-items:center;gap:5px;color:var(--muted);font-size:0.88rem;cursor:pointer;margin-top:12px;background:none;border:none;font-family:'Tajawal',sans-serif;font-weight:600;}

/* â”€â”€ BUTTONS â”€â”€ */
.btn{
  width:100%;padding:14px;border:none;border-radius:13px;
  font-size:1rem;font-weight:700;font-family:'Tajawal',sans-serif;
  cursor:pointer;transition:all .22s;display:flex;
  align-items:center;justify-content:center;gap:8px;margin-bottom:8px;
}
.btn-gold{background:linear-gradient(135deg,var(--gold),var(--gold2));color:var(--g);box-shadow:0 4px 14px rgba(200,152,42,.35);}
.btn-gold:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(200,152,42,.45);}
.btn-dark{background:linear-gradient(135deg,var(--g),var(--g2));color:#fff;box-shadow:0 4px 14px rgba(14,77,58,.3);}
.btn-dark:hover{transform:translateY(-2px);}
.btn-ghost{background:var(--cream2);color:var(--g);border:2px solid var(--border);}
.btn-red{background:linear-gradient(135deg,#c0392b,var(--red));color:#fff;}
.btn-sm{padding:9px 14px;font-size:0.85rem;border-radius:10px;width:auto;margin-bottom:0;}

/* â”€â”€ REMEMBER ME â”€â”€ */
.remember-row{display:flex;align-items:center;gap:10px;background:var(--cream2);padding:12px;border-radius:11px;margin-bottom:14px;cursor:pointer;}
.remember-row input[type=checkbox]{width:20px;height:20px;cursor:pointer;accent-color:var(--g);flex-shrink:0;}
.remember-row label{cursor:pointer;font-size:0.9rem;font-weight:600;color:var(--g);}

/* â”€â”€ SAVED CREDS BANNER â”€â”€ */
.saved-banner{background:linear-gradient(135deg,#e6f7f0,#d0ece5);border:2px solid var(--g3);border-radius:14px;padding:14px 16px;margin-bottom:14px;display:none;}
.saved-banner .sb-name{font-weight:700;color:var(--g);font-size:1rem;margin-bottom:10px;}
.saved-banner .sb-hint{font-size:0.8rem;color:var(--muted);margin-top:6px;text-align:center;}

/* â”€â”€ WELCOME BANNER â”€â”€ */
.welcome{
  background:linear-gradient(135deg,var(--g),var(--g2));
  border-radius:16px;padding:16px 18px;
  display:flex;align-items:center;gap:12px;
  margin-bottom:16px;box-shadow:var(--sh2);
}
.welcome-av{width:46px;height:46px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold2));display:flex;align-items:center;justify-content:center;font-size:1.4rem;flex-shrink:0;border:2px solid rgba(255,255,255,.3);}
.welcome-name{color:#fff;font-weight:700;font-size:1rem;}
.welcome-sub{color:rgba(255,255,255,.65);font-size:0.78rem;margin-top:2px;}

/* â”€â”€ TABS â”€â”€ */
.tabs{display:flex;gap:5px;background:var(--cream2);padding:5px;border-radius:14px;margin-bottom:16px;}
.tab{flex:1;padding:10px;text-align:center;border-radius:10px;font-weight:700;font-size:0.88rem;cursor:pointer;color:var(--muted);border:none;background:none;font-family:'Tajawal',sans-serif;transition:all .22s;position:relative;}
.tab.on{background:#fff;color:var(--g);box-shadow:0 2px 8px rgba(0,0,0,.08);}
.tab-dot{position:absolute;top:-3px;right:-3px;width:14px;height:14px;background:var(--red);color:#fff;border-radius:50%;font-size:0.6rem;font-weight:900;display:flex;align-items:center;justify-content:center;border:2px solid var(--cream2);}

/* â”€â”€ TYPE GRID â”€â”€ */
.type-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;}
.type-card{background:#fff;border:2.5px solid var(--border);border-radius:14px;padding:18px 10px;text-align:center;cursor:pointer;transition:all .22s;}
.type-card.on{border-color:var(--gold);background:linear-gradient(135deg,#fdf8ee,#fff);box-shadow:0 2px 12px rgba(200,152,42,.2);}
.type-icon{font-size:2.2rem;display:block;margin-bottom:6px;}
.type-lbl{font-weight:700;font-size:0.9rem;color:var(--g);}

/* â”€â”€ LIVE BOX â”€â”€ */
.live-box{border-radius:14px;overflow:hidden;border:2.5px solid var(--gold);background:#000;margin-bottom:12px;display:none;position:relative;}
.live-box.on{display:block;}
.live-box video{width:100%;display:block;max-height:220px;object-fit:cover;}
.live-box.rec{border-color:var(--red);animation:recPulse 1.2s infinite;}
@keyframes recPulse{0%,100%{box-shadow:0 0 0 0 rgba(231,76,60,.5)}50%{box-shadow:0 0 0 8px rgba(231,76,60,0)}}
.rec-badge{position:absolute;top:8px;right:8px;background:var(--red);color:#fff;border-radius:20px;padding:4px 10px;font-size:0.75rem;font-weight:700;display:none;align-items:center;gap:5px;}
.rec-badge.on{display:flex;}
.rec-dot-anim{width:7px;height:7px;background:#fff;border-radius:50%;animation:blink 1s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}

/* â”€â”€ TIMER â”€â”€ */
.big-timer{text-align:center;font-size:2.4rem;font-weight:900;color:var(--g);letter-spacing:3px;display:none;margin:6px 0;}
.big-timer.on{display:block;}

/* â”€â”€ PREVIEW BOX â”€â”€ */
.prev-box{background:linear-gradient(135deg,var(--cream),#fff);border:2px solid var(--gold);border-radius:14px;padding:16px;margin-bottom:14px;display:none;}
.prev-box.on{display:block;}
.prev-box audio,.prev-box video{width:100%;border-radius:10px;margin-top:8px;}
.prev-btns{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px;}

/* â”€â”€ RECORDING CARD â”€â”€ */
.rec-card{background:#fff;border:1.5px solid var(--border);border-radius:16px;margin-bottom:14px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.05);}
.rec-card-top{padding:12px 14px 8px;display:flex;align-items:center;justify-content:space-between;}
.rec-num{background:linear-gradient(135deg,var(--g),var(--g2));color:#fff;border-radius:8px;padding:4px 12px;font-size:0.78rem;font-weight:700;}
.rec-type{background:var(--cream2);color:var(--g);border-radius:8px;padding:4px 12px;font-size:0.78rem;font-weight:700;border:1px solid var(--border);}
.rec-date{padding:0 14px 8px;color:var(--muted);font-size:0.75rem;}
.rec-media{padding:0 14px 12px;}
.rec-media audio,.rec-media video{width:100%;border-radius:10px;}
.rec-del-btn{display:flex;align-items:center;justify-content:center;gap:6px;padding:10px;background:none;border:none;border-top:1px solid var(--border);color:var(--muted);font-size:0.82rem;font-weight:700;cursor:pointer;font-family:'Tajawal',sans-serif;width:100%;transition:all .2s;}
.rec-del-btn:hover{background:#fef2f2;color:var(--red);}

/* â”€â”€ MESSAGES SECTION (under recording) â”€â”€ */
.msgs-area{border-top:2px dashed var(--border);background:linear-gradient(135deg,#fdf8ee,#fff);}
.msgs-area-title{padding:10px 14px 6px;font-size:0.8rem;font-weight:700;color:var(--gold);display:flex;align-items:center;gap:5px;}
.msg-item{margin:0 10px 8px;background:#fff;border-radius:12px;padding:10px 12px;border:1.5px solid var(--border);border-right:3px solid var(--gold);}
.msg-item.new-msg{border-right-color:var(--red);background:linear-gradient(135deg,#fff5f5,#fff);}
.msg-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;}
.msg-label{font-size:0.75rem;font-weight:700;color:var(--gold);}
.msg-label.red{color:var(--red);}
.msg-date{font-size:0.7rem;color:var(--muted);}
.msg-body{font-size:0.88rem;color:var(--ink);line-height:1.5;}
.msg-audio{margin-top:7px;}
.msg-audio audio{width:100%;border-radius:8px;}
.msg-rating-box{background:linear-gradient(135deg,#fef9ec,#fdf0c0);border:1.5px solid var(--gold);border-radius:10px;padding:10px;text-align:center;margin-top:7px;}
.msg-stars{font-size:1.3rem;}
.msg-score{font-size:1.1rem;font-weight:900;color:var(--g);margin-top:3px;}
.new-indicator{display:inline-block;width:8px;height:8px;background:var(--red);border-radius:50%;margin-left:4px;}

/* â”€â”€ ADMIN STATS â”€â”€ */
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:14px;}
.stat{background:linear-gradient(135deg,var(--g),var(--g2));border-radius:14px;padding:12px 8px;text-align:center;box-shadow:0 4px 14px rgba(14,77,58,.25);}
.stat-n{font-size:1.6rem;font-weight:900;color:var(--gold3);}
.stat-l{font-size:0.7rem;color:rgba(255,255,255,.7);font-weight:600;}

.part-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(105px,1fr));gap:8px;}
.part-card{background:#fff;border:2px solid var(--border);border-radius:14px;padding:14px 8px;text-align:center;cursor:pointer;transition:all .22s;position:relative;box-shadow:0 2px 6px rgba(0,0,0,.04);}
.part-card:hover,.part-card:active{border-color:var(--gold);transform:translateY(-3px);box-shadow:var(--sh);}
.part-card-icon{font-size:2rem;margin-bottom:5px;}
.part-card-name{color:var(--g);font-size:0.85rem;font-weight:700;word-break:break-word;margin-bottom:2px;}
.part-card-count{color:var(--muted);font-size:0.72rem;}
.new-bubble{position:absolute;top:-6px;right:-6px;background:var(--red);color:#fff;border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center;font-size:0.7rem;font-weight:900;border:2px solid #fff;box-shadow:0 2px 6px rgba(231,76,60,.4);}

/* â”€â”€ TOTAL BADGE â”€â”€ */
.total-badge{background:linear-gradient(135deg,#fef9ec,#fdf0c0);border:2px solid var(--gold);border-radius:12px;padding:10px 16px;display:none;align-items:center;gap:8px;margin-bottom:12px;font-weight:700;color:var(--g);font-size:0.9rem;box-shadow:0 2px 8px rgba(200,152,42,.2);}
.total-badge.on{display:flex;}
.total-num{font-size:1.2rem;font-weight:900;}

/* â”€â”€ CONTACT CARD â”€â”€ */
.contact-card{background:linear-gradient(135deg,#e6f7f0,#d4ede7);border:2px solid rgba(14,77,58,.2);border-radius:14px;padding:14px;margin-bottom:12px;}
.contact-head{display:flex;justify-content:space-between;align-items:center;}
.contact-body{margin-top:12px;}
.info-row{background:#fff;border-radius:10px;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;margin-bottom:7px;border:1px solid var(--border);}
.info-row:last-child{margin-bottom:0;}
.info-lbl{font-size:0.75rem;color:var(--muted);margin-bottom:2px;}
.info-val{font-weight:700;color:var(--g);font-size:0.95rem;word-break:break-all;}
.copy-btn{background:var(--g);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-size:0.78rem;font-weight:700;font-family:'Tajawal',sans-serif;transition:all .2s;flex-shrink:0;}
.copy-btn:hover{background:var(--g2);}
.copy-btn.ok{background:#10b981;}

/* â”€â”€ SEND ACTIONS (under each rec for admin) â”€â”€ */
.rec-actions{display:flex;border-top:1px solid var(--border);}
.rec-act-btn{flex:1;padding:10px 4px;text-align:center;font-size:0.78rem;font-weight:700;cursor:pointer;color:var(--g);border:none;background:none;font-family:'Tajawal',sans-serif;transition:all .2s;line-height:1.4;}
.rec-act-btn:not(:last-child){border-left:1px solid var(--border);}
.rec-act-btn:hover,.rec-act-btn:active{background:var(--cream);}
.rec-act-btn.danger{color:var(--red);}
.rec-act-btn.danger:hover{background:#fef2f2;}

/* â”€â”€ BOTTOM SHEET â”€â”€ */
.sheet-bg{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:600;display:flex;align-items:flex-end;justify-content:center;backdrop-filter:blur(3px);}
.sheet{background:#fff;border-radius:22px 22px 0 0;width:100%;max-width:520px;padding:18px 16px 36px;max-height:88vh;overflow-y:auto;animation:sheetUp .3s cubic-bezier(.34,1.3,.64,1);}
@keyframes sheetUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.sheet-handle{width:38px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 16px;}
.sheet-title{font-weight:700;font-size:1.05rem;color:var(--g);margin-bottom:14px;}
.s-tabs{display:flex;gap:6px;margin-bottom:14px;}
.s-tab{flex:1;padding:9px;border:2px solid var(--border);border-radius:10px;background:#fff;font-size:0.82rem;font-weight:700;cursor:pointer;color:var(--muted);font-family:'Tajawal',sans-serif;transition:all .2s;}
.s-tab.on{background:linear-gradient(135deg,var(--gold),var(--gold2));color:var(--g);border-color:transparent;}
.s-textarea{width:100%;padding:12px;border:2px solid var(--border);border-radius:12px;font-family:'Tajawal',sans-serif;font-size:0.95rem;min-height:100px;resize:vertical;background:var(--cream);}
.s-textarea:focus{outline:none;border-color:var(--gold);}
.voice-box{background:var(--cream);border:2px solid var(--gold);border-radius:12px;padding:14px;}
.rating-box{background:var(--cream);border:2px solid var(--gold);border-radius:12px;padding:16px;text-align:center;}
.stars-row{display:flex;justify-content:center;gap:5px;font-size:2.4rem;margin:10px 0;}
.star{cursor:pointer;transition:transform .15s;user-select:none;display:inline-block;}
.star:hover{transform:scale(1.2);}
.rat-val{font-size:1.4rem;font-weight:900;color:var(--g);margin-bottom:10px;}
.rat-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:5px;}
.rat-btn{padding:7px;border:2px solid var(--border);border-radius:7px;background:#fff;cursor:pointer;font-size:0.8rem;font-weight:700;font-family:'Tajawal',sans-serif;transition:all .2s;}
.rat-btn.on,.rat-btn:hover{background:linear-gradient(135deg,var(--gold),var(--gold2));border-color:transparent;color:var(--g);}
.sheet-btns{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:14px;}
.voice-timer{font-size:1.5rem;font-weight:900;color:var(--g);text-align:center;display:none;margin:6px 0;}
.voice-timer.on{display:block;}

/* â”€â”€ CONFIRM â”€â”€ */
.confirm-bg{position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:700;display:flex;align-items:center;justify-content:center;padding:16px;backdrop-filter:blur(3px);}
.confirm-box{background:#fff;border-radius:20px;padding:24px 20px;max-width:340px;width:100%;text-align:center;animation:popIn .25s cubic-bezier(.34,1.5,.64,1);}
@keyframes popIn{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}
.confirm-em{font-size:2.8rem;margin-bottom:10px;}
.confirm-ttl{font-size:1.05rem;font-weight:700;color:var(--ink);margin-bottom:6px;}
.confirm-desc{font-size:0.85rem;color:var(--muted);margin-bottom:18px;line-height:1.5;}
.confirm-btns{display:grid;grid-template-columns:1fr 1fr;gap:8px;}

/* â”€â”€ LOADER â”€â”€ */
.loader-bg{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(3px);}
.loader-box{background:#fff;border-radius:18px;padding:26px 30px;text-align:center;box-shadow:var(--sh2);}
.loader-spin{width:42px;height:42px;border:4px solid var(--cream2);border-top-color:var(--gold);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 10px;}
@keyframes spin{to{transform:rotate(360deg)}}
.loader-txt{font-weight:700;color:var(--g);font-size:0.88rem;}

/* â”€â”€ EMPTY â”€â”€ */
.empty{text-align:center;padding:30px 16px;color:var(--muted);}
.empty .ei{font-size:2.8rem;opacity:.4;margin-bottom:8px;}

/* â”€â”€ TOAST â”€â”€ */
.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);background:var(--g);color:#fff;padding:10px 22px;border-radius:30px;font-weight:700;font-size:0.88rem;z-index:9999;box-shadow:var(--sh2);animation:sheetUp .3s;pointer-events:none;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“ SPOTLIGHT TUTORIAL â€” REBUILT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#tutBg{
  position:fixed;inset:0;z-index:5000;
  /* starts hidden */
  display:none;
}
#tutBg.on{display:block;}

/* SVG mask layer */
#tutSvg{position:absolute;inset:0;width:100%;height:100%;pointer-events:none;}

/* card */
#tutCard{
  position:fixed;
  background:var(--g);
  border-radius:18px;padding:16px 18px 14px;
  width:calc(100vw - 28px);max-width:300px;
  box-shadow:0 16px 48px rgba(0,0,0,.4),0 0 0 1.5px rgba(200,152,42,.5);
  color:#fff;
  z-index:5001;
  /* hide until positioned */
  opacity:0;pointer-events:none;
  transition:opacity .25s;
}
#tutCard.visible{opacity:1;pointer-events:all;}

/* arrow */
#tutCard::after{
  content:'';position:absolute;
  width:13px;height:13px;
  background:var(--g);
  transform:rotate(45deg);
}
#tutCard.arr-down::after{bottom:-6px;right:24px;box-shadow:2px 2px 3px rgba(0,0,0,.15);}
#tutCard.arr-up::after{top:-6px;right:24px;box-shadow:-1px -1px 0 rgba(200,152,42,.3);}
#tutCard.arr-none::after{display:none;}

.tut-num{font-size:0.68rem;font-weight:700;color:var(--gold3);margin-bottom:4px;letter-spacing:.5px;}
.tut-ttl{font-size:1rem;font-weight:700;color:#fff;margin-bottom:6px;}
.tut-desc{font-size:0.82rem;line-height:1.6;color:rgba(255,255,255,.85);}
.tut-tip{background:rgba(200,152,42,.2);border:1px solid rgba(200,152,42,.4);border-radius:8px;padding:8px 10px;margin-top:8px;font-size:0.78rem;color:var(--gold3);font-weight:600;line-height:1.4;}
.tut-foot{display:flex;align-items:center;justify-content:space-between;margin-top:13px;padding-top:10px;border-top:1px solid rgba(255,255,255,.15);}
.tut-dots{display:flex;gap:4px;align-items:center;}
.tut-dot{width:6px;height:6px;border-radius:3px;background:rgba(255,255,255,.25);transition:all .28s;}
.tut-dot.on{width:16px;background:var(--gold2);}
.tut-actions{display:flex;gap:6px;align-items:center;}
.tut-skip-btn{background:none;border:none;color:rgba(255,255,255,.45);font-size:0.76rem;cursor:pointer;font-family:'Tajawal',sans-serif;padding:4px;}
.tut-prev-btn{background:rgba(255,255,255,.1);color:#fff;border:none;border-radius:8px;padding:7px 10px;font-size:0.8rem;font-weight:700;cursor:pointer;font-family:'Tajawal',sans-serif;}
.tut-next-btn{background:linear-gradient(135deg,var(--gold),var(--gold2));color:var(--g);border:none;border-radius:8px;padding:7px 14px;font-size:0.82rem;font-weight:700;cursor:pointer;font-family:'Tajawal',sans-serif;}

/* pulse ring around highlighted element */
#tutRing{
  position:fixed;
  border:2.5px solid rgba(200,152,42,.9);
  border-radius:14px;
  pointer-events:none;
  z-index:5002;
  display:none;
  animation:ringPulse 1.4s infinite;
}
@keyframes ringPulse{
  0%,100%{box-shadow:0 0 0 0 rgba(200,152,42,.6)}
  50%{box-shadow:0 0 0 10px rgba(200,152,42,0)}
}

/* â”€â”€ REG TUTORIAL (inline, simpler) â”€â”€ */
.reg-tut{background:linear-gradient(135deg,var(--g),var(--g2));border-radius:14px;padding:14px 16px;margin-bottom:16px;color:#fff;display:none;}
.reg-tut.on{display:block;}
.rt-step{font-size:0.68rem;font-weight:700;color:var(--gold3);margin-bottom:4px;}
.rt-title{font-size:0.95rem;font-weight:700;margin-bottom:5px;}
.rt-desc{font-size:0.82rem;line-height:1.5;color:rgba(255,255,255,.85);}
.rt-foot{display:flex;align-items:center;justify-content:space-between;margin-top:10px;}
.rt-dots{display:flex;gap:4px;}
.rt-dot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.25);}
.rt-dot.on{background:var(--gold2);}
.rt-btns{display:flex;gap:6px;}
.rt-prev{background:rgba(255,255,255,.15);border:none;color:#fff;padding:6px 10px;border-radius:8px;font-size:0.8rem;font-weight:700;cursor:pointer;font-family:'Tajawal',sans-serif;}
.rt-next{background:linear-gradient(135deg,var(--gold),var(--gold2));border:none;color:var(--g);padding:6px 12px;border-radius:8px;font-size:0.8rem;font-weight:700;cursor:pointer;font-family:'Tajawal',sans-serif;}

@media(max-width:400px){
  .hero h1{font-size:1.5rem;}
  .big-timer{font-size:2rem;}
  .stat-n{font-size:1.3rem;}
}
</style>
</head>
<body>

<!-- TOPBAR -->
<div id="topbar">
  <div class="tb-logo">
    <img src="360_F_498618110_CmzpqAOH4xxhBFqXKEx5cOwYhvHpnmDH.jpg" alt="" onerror="this.style.display='none';this.parentElement.textContent='ğŸŒ™'"/>
  </div>
  <div class="tb-info">
    <div class="tb-title">Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¬Ø²Ø¡ Ø¹Ù…</div>
    <div class="tb-sub">Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ 1446 âœ¨</div>
  </div>
  <div id="tbActions"></div>
</div>

<div id="main">

<!-- â•â• Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© â•â• -->
<div class="pg on" id="pg-home">
  <div class="hero">
    <span class="hero-icon">ğŸŒ™</span>
    <h1>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø­ÙØ¸ Ø¬Ø²Ø¡ Ø¹Ù…</h1>
    <p>Ø³Ø¬Ù‘Ù„ÙŠ Ø­ÙØ¸Ùƒ ÙˆØ£Ø±Ø³Ù„ÙŠÙ‡ Ù„Ù„Ø§Ø³ØªØ§Ø°Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</p>
    <div class="hero-badge">â­ Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ 1446 â­</div>
  </div>
  <button class="home-btn" onclick="go('pg-register')">
    <div class="hb-icon">ğŸ†•</div>
    <div class="hb-info"><div class="hb-title">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</div><div class="hb-desc">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ â€” Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</div></div>
    <div class="hb-arr">â—€</div>
  </button>
  <button class="home-btn" onclick="go('pg-login')">
    <div class="hb-icon">ğŸ”‘</div>
    <div class="hb-info"><div class="hb-title">Ø¯Ø®ÙˆÙ„</div><div class="hb-desc">Ù„Ø¯ÙŠÙƒÙ Ø­Ø³Ø§Ø¨ØŸ Ø§Ø¯Ø®Ù„ÙŠ Ù…Ù† Ù‡Ù†Ø§</div></div>
    <div class="hb-arr">â—€</div>
  </button>
  <button class="home-btn dashed" onclick="go('pg-admin-login')">
    <div class="hb-icon">ğŸ‘©â€ğŸ«</div>
    <div class="hb-info"><div class="hb-title">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§Ø³ØªØ§Ø°Ø©</div><div class="hb-desc">Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…</div></div>
    <div class="hb-arr">â—€</div>
  </button>
</div>

<!-- â•â• ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ â•â• -->
<div class="pg" id="pg-register">
  <!-- ØªÙˆØªÙˆØ±ÙŠØ§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ inline -->
  <div class="reg-tut on" id="regTut">
    <div class="rt-step" id="rtStep">Ø®Ø·ÙˆØ© 1 Ù…Ù† 3</div>
    <div class="rt-title" id="rtTitle"></div>
    <div class="rt-desc" id="rtDesc"></div>
    <div class="rt-foot">
      <div class="rt-dots" id="rtDots"></div>
      <div class="rt-btns">
        <button class="rt-prev" id="rtPrev" onclick="rtPrevStep()" style="display:none;">â—€</button>
        <button class="rt-next" id="rtNext" onclick="rtNextStep()">Ø§Ù„ØªØ§Ù„ÙŠ â–¶</button>
      </div>
    </div>
  </div>
  <div class="card">
    <div class="card-title">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</div>
    <form id="regForm">
      <div class="f-group" id="rg-name">
        <label class="f-label" for="regName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <input class="f-input" type="text" id="regName" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required/>
      </div>
      <div class="f-group" id="rg-pass">
        <label class="f-label" for="regPass">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <div class="pw-wrap">
          <input class="f-input" type="password" id="regPass" placeholder="Ø±Ù‚Ù… Ø³Ù‡Ù„ ØªØ­ÙØ¸ÙŠÙ†Ù‡" style="padding-left:42px" required/>
          <span class="pw-eye" onclick="togglePw('regPass',this)">ğŸ‘ï¸</span>
        </div>
        <p style="font-size:0.76rem;color:var(--muted);margin-top:5px;">ğŸ’¡ Ù…Ø«Ø§Ù„: Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ø£Ùˆ ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯Ùƒ</p>
      </div>
      <button type="submit" class="btn btn-gold">Ø£Ù†Ø´Ø¦ÙŠ Ø­Ø³Ø§Ø¨ÙŠ âœ¨</button>
    </form>
    <button class="back-lnk" onclick="go('pg-home')">â—€ Ø±Ø¬ÙˆØ¹</button>
  </div>
</div>

<!-- â•â• Ø§Ù„Ø¯Ø®ÙˆÙ„ â•â• -->
<div class="pg" id="pg-login">
  <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© -->
  <div class="saved-banner" id="savedBanner">
    <div class="sb-name" id="savedName">Ù…Ø±Ø­Ø¨Ø§Ù‹!</div>
    <button class="btn btn-dark" onclick="autoLogin()">ğŸš€ Ø¯Ø®ÙˆÙ„ Ù…Ø¨Ø§Ø´Ø± Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</button>
    <div class="sb-hint">Ø£Ùˆ Ø§Ø¯Ø®Ù„ÙŠ Ø¨Ø­Ø³Ø§Ø¨ Ø¢Ø®Ø± Ø£Ø¯Ù†Ø§Ù‡</div>
  </div>
  <div class="card">
    <div class="card-title">ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</div>
    <div class="err-box" id="loginErr"></div>
    <form id="loginForm">
      <div class="f-group">
        <label class="f-label" for="loginName">Ø§Ù„Ø§Ø³Ù…</label>
        <input class="f-input" type="text" id="loginName" placeholder="Ø§Ø³Ù…Ùƒ" required/>
      </div>
      <div class="f-group">
        <label class="f-label" for="loginPass">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <div class="pw-wrap">
          <input class="f-input" type="password" id="loginPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="padding-left:42px" required/>
          <span class="pw-eye" onclick="togglePw('loginPass',this)">ğŸ‘ï¸</span>
        </div>
      </div>
      <div class="remember-row" onclick="document.getElementById('remMe').click()">
        <input type="checkbox" id="remMe" checked onclick="event.stopPropagation()"/>
        <label for="remMe">ğŸ’¾ Ø§Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</label>
      </div>
      <button type="submit" class="btn btn-gold">Ø¯Ø®ÙˆÙ„ ğŸ”“</button>
    </form>
    <button class="back-lnk" onclick="go('pg-home')">â—€ Ø±Ø¬ÙˆØ¹</button>
  </div>
</div>

<!-- â•â• Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§Ø³ØªØ§Ø°Ø© â•â• -->
<div class="pg" id="pg-admin-login">
  <div class="card">
    <div class="card-title">ğŸ‘©â€ğŸ« Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§Ø³ØªØ§Ø°Ø©</div>
    <div class="err-box" id="adminErr"></div>
    <form id="adminForm">
      <div class="f-group">
        <label class="f-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <div class="pw-wrap">
          <input class="f-input" type="password" id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="padding-left:42px" required/>
          <span class="pw-eye" onclick="togglePw('adminPass',this)">ğŸ‘ï¸</span>
        </div>
      </div>
      <button type="submit" class="btn btn-gold">Ø¯Ø®ÙˆÙ„</button>
    </form>
    <button class="back-lnk" onclick="go('pg-home')">â—€ Ø±Ø¬ÙˆØ¹</button>
  </div>
</div>

<!-- â•â• ØµÙØ­Ø© Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ â•â• -->
<div class="pg" id="pg-part">
  <div class="welcome" id="welcomeBanner">
    <div class="welcome-av">ğŸŒ¸</div>
    <div>
      <div class="welcome-name" id="welcomeName"></div>
      <div class="welcome-sub">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¬Ø²Ø¡ Ø¹Ù… ğŸŒ™</div>
    </div>
  </div>
  <div class="tabs" id="partTabs">
    <button class="tab on" id="tab-rec" onclick="switchTab('rec')">ğŸ¤ ØªØ³Ø¬ÙŠÙ„</button>
    <button class="tab" id="tab-msg" onclick="switchTab('msg')" style="position:relative;">
      ğŸ“¬ Ø±Ø³Ø§Ø¦Ù„ÙŠ
      <span id="unreadDot" class="tab-dot" style="display:none;"></span>
    </button>
  </div>

  <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
  <div id="secRec">
    <div class="card" style="padding-bottom:10px;">
      <div class="card-title" style="margin-bottom:10px;">Ø§Ø®ØªØ§Ø±ÙŠ Ù†ÙˆØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div>
      <div class="type-grid" id="typeGrid">
        <div class="type-card on" id="tc-audio" onclick="selType('audio')">
          <span class="type-icon">ğŸ¤</span>
          <span class="type-lbl">ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ</span>
        </div>
        <div class="type-card" id="tc-video" onclick="selType('video')">
          <span class="type-icon">ğŸ¥</span>
          <span class="type-lbl">ØªØ³Ø¬ÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ</span>
        </div>
      </div>
      <div class="live-box" id="liveBox">
        <video id="liveVid" autoplay muted playsinline></video>
        <div class="rec-badge" id="recBadge"><span class="rec-dot-anim"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div>
      </div>
      <div class="big-timer" id="bigTimer">00:00</div>
      <button class="btn btn-gold" id="startBtn" onclick="startRec()">ğŸ”´ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
      <button class="btn btn-red" id="stopBtn" onclick="stopRec()" style="display:none;">â¹ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
    </div>
    <div class="prev-box" id="prevBox">
      <div style="font-weight:700;color:var(--g);font-size:0.95rem;">ğŸ§ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div>
      <div id="prevMedia"></div>
      <div class="prev-btns">
        <button class="btn btn-gold" onclick="saveRec()">ğŸ’¾ Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„</button>
        <button class="btn btn-ghost" onclick="cancelRec()">ğŸ”„ Ø³Ø¬Ù‘Ù„ÙŠ Ù…Ø¬Ø¯Ø¯Ø§Ù‹</button>
      </div>
    </div>
    <div style="margin-top:16px;">
      <div style="font-weight:700;font-size:1rem;color:var(--g);margin-bottom:12px;">ğŸ“ ØªØ³Ø¬ÙŠÙ„Ø§ØªÙŠ ÙˆØ±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø§Ø³ØªØ§Ø°Ø©</div>
      <div id="myRecsList"></div>
    </div>
  </div>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙƒÙ„ÙŠ -->
  <div id="secMsg" style="display:none;">
    <div style="font-weight:700;font-size:1rem;color:var(--g);margin-bottom:12px;">ğŸ“¬ ÙƒÙ„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø§Ø³ØªØ§Ø°Ø©</div>
    <div id="allMsgsList"></div>
  </div>
</div>

<!-- â•â• Ø§Ù„Ø§Ø³ØªØ§Ø°Ø© - Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† â•â• -->
<div class="pg" id="pg-admin">
  <div class="stats">
    <div class="stat"><div class="stat-n" id="stN">0</div><div class="stat-l">ğŸ‘¥ Ù…Ø´Ø§Ø±Ùƒ</div></div>
    <div class="stat"><div class="stat-n" id="stR">0</div><div class="stat-l">ğŸ™ï¸ ØªØ³Ø¬ÙŠÙ„</div></div>
    <div class="stat"><div class="stat-n" id="stNew">0</div><div class="stat-l">ğŸ†• Ø¬Ø¯ÙŠØ¯</div></div>
  </div>
  <div class="part-grid" id="partGrid"></div>
</div>

<!-- â•â• Ø§Ù„Ø§Ø³ØªØ§Ø°Ø© - ØªØ³Ø¬ÙŠÙ„Ø§Øª Ù…Ø´Ø§Ø±Ùƒ â•â• -->
<div class="pg" id="pg-admin-recs">
  <div style="text-align:center;margin-bottom:10px;">
    <div class="total-badge" id="totalBadge">
      â­ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: <span class="total-num" id="totalVal">0</span> / <span class="total-num" id="totalMax">0</span>
    </div>
  </div>
  <div class="contact-card">
    <div class="contact-head">
      <span style="font-weight:700;color:var(--g);font-size:0.9rem;">ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</span>
      <button class="btn-sm btn btn-dark" onclick="toggleContact()" id="contactTogBtn" style="margin-bottom:0;padding:7px 14px;">Ø¹Ø±Ø¶</button>
    </div>
    <div class="contact-body" id="contactBody" style="display:none;">
      <div class="info-row"><div><div class="info-lbl">Ø§Ù„Ø§Ø³Ù…</div><div class="info-val" id="cName"></div></div><button class="copy-btn" onclick="copyIt('name',this)">ğŸ“‹ Ù†Ø³Ø®</button></div>
      <div class="info-row"><div><div class="info-lbl">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div><div class="info-val" id="cPass"></div></div><button class="copy-btn" onclick="copyIt('pass',this)">ğŸ“‹ Ù†Ø³Ø®</button></div>
    </div>
  </div>
  <div id="adminRecsList"></div>
</div>

</div><!-- /main -->

<!-- â•â• SPOTLIGHT TUTORIAL â•â• -->
<div id="tutBg">
  <svg id="tutSvg"></svg>
  <div id="tutCard">
    <div class="tut-num" id="tutNum">Ø®Ø·ÙˆØ© 1 Ù…Ù† 4</div>
    <div class="tut-ttl" id="tutTtl"></div>
    <div class="tut-desc" id="tutDesc"></div>
    <div class="tut-tip" id="tutTip" style="display:none;"></div>
    <div class="tut-foot">
      <div class="tut-dots" id="tutDots"></div>
      <div class="tut-actions">
        <button class="tut-prev-btn" id="tutPrev" onclick="tPrev()" style="display:none;">â—€</button>
        <button class="tut-skip-btn" onclick="tSkip()">ØªØ®Ø·ÙŠ</button>
        <button class="tut-next-btn" id="tutNext" onclick="tNext()">Ø§Ù„ØªØ§Ù„ÙŠ â–¶</button>
      </div>
    </div>
  </div>
  <div id="tutRing"></div>
</div>

<!-- Firebase -->
<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import{getDatabase,ref,set,get,push,update}from"https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";
const app=initializeApp({apiKey:"AIzaSyAfhQL5spF3KcrbngSzunLaHT_7cieHkUk",authDomain:"opject-e223d.firebaseapp.com",databaseURL:"https://opject-e223d-default-rtdb.firebaseio.com/",projectId:"opject-e223d",storageBucket:"opject-e223d.firebasestorage.app",messagingSenderId:"607939195786",appId:"1:607939195786:web:c264710387d50fc2990e73"});
const db=getDatabase(app);
window.DB=db;window.R=ref;window.S=set;window.G=get;window.P=push;window.U=update;window.FB=true;
</script>

<script>
// â•â•â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â•â•â•
let user=null,isAdmin=false,curPart=null;
let mr=null,mrC=[],mrType='audio',mrTimer=null,mrStart=null,previewStream=null;
let avr=null,avrC=[],avrTimer=null;
let curRecMsg=null,selRat=0;
let viewed=new Set();

// â•â•â•â•â•â•â•â•â•â• BOOT â•â•â•â•â•â•â•â•â•â•
window.onload=function(){
  const ck=setInterval(()=>{
    if(window.FB&&window.DB){
      clearInterval(ck);
      loadViewed();
      bootSession();
    }
  },80);
  setTimeout(()=>{clearInterval(ck);if(!window.DB){alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ - Ø­Ø¯Ù‘Ø«ÙŠ Ø§Ù„ØµÙØ­Ø©');go('pg-home');}},7000);
};

// â•â•â•â•â•â•â•â•â•â• SESSION + AUTO-LOGIN â•â•â•â•â•â•â•â•â•â•
function loadViewed(){const s=localStorage.getItem('vr');if(s)viewed=new Set(JSON.parse(s));}
function saveViewed(){localStorage.setItem('vr',JSON.stringify([...viewed]));}
function markV(p,r){viewed.add(p+'_'+r);saveViewed();}
function isV(p,r){return viewed.has(p+'_'+r);}

function saveCreds(n,p){localStorage.setItem('uc',JSON.stringify({n,p}));}
function loadCreds(){const s=localStorage.getItem('uc');return s?JSON.parse(s):null;}
function clearCreds(){localStorage.removeItem('uc');}

async function bootSession(){
  const sess=localStorage.getItem('sess');
  if(sess){
    const d=JSON.parse(sess);
    if(d.a){isAdmin=true;goAdmin();return;}
    showLoader();
    try{
      const snap=await window.G(window.R(window.DB,'participants/'+d.u));
      hideLoader();
      if(snap.exists()){user={id:d.u,...snap.val()};goPart();return;}
    }catch(e){hideLoader();}
    localStorage.removeItem('sess');
  }
  // try saved creds
  const creds=loadCreds();
  if(creds){
    showLoader();
    try{
      const snap=await window.G(window.R(window.DB,'participants'));
      hideLoader();
      if(snap.exists()){
        let f=null,fi=null;
        Object.entries(snap.val()).forEach(([id,p])=>{if(p.name===creds.n&&p.password===creds.p){f=p;fi=id;}});
        if(f){user={id:fi,...f};localStorage.setItem('sess',JSON.stringify({u:fi}));goPart();return;}
      }
    }catch(e){hideLoader();}
  }
  go('pg-home');
}

async function autoLogin(){
  const creds=loadCreds();if(!creds)return;
  showLoader();
  try{
    const snap=await window.G(window.R(window.DB,'participants'));
    hideLoader();
    if(snap.exists()){
      let f=null,fi=null;
      Object.entries(snap.val()).forEach(([id,p])=>{if(p.name===creds.n&&p.password===creds.p){f=p;fi=id;}});
      if(f){user={id:fi,...f};localStorage.setItem('sess',JSON.stringify({u:fi}));goPart();return;}
    }
    hideLoader();showErr('loginErr','Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù… ØªØ¹Ù…Ù„');clearCreds();
    document.getElementById('savedBanner').style.display='none';
  }catch(e){hideLoader();showErr('loginErr','Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');}
}

// â•â•â•â•â•â•â•â•â•â• NAVIGATION â•â•â•â•â•â•â•â•â•â•
function go(id){
  document.querySelectorAll('.pg').forEach(p=>p.classList.remove('on'));
  document.getElementById(id).classList.add('on');
  updateTopbar();
  window.scrollTo({top:0,behavior:'smooth'});
  if(id==='pg-login') checkSavedBanner();
  if(id==='pg-register') initRegTut();
}

function updateTopbar(){
  const el=document.getElementById('tbActions');
  el.innerHTML='';
  if(user||isAdmin){
    const b=mkBtn('Ø®Ø±ÙˆØ¬',logout,'tb-btn');el.appendChild(b);
  }
  if(isAdmin){
    const h=mkBtn('â“ Ù…Ø³Ø§Ø¹Ø¯Ø©',()=>startTut('admin'),'tb-btn gold');el.appendChild(h);
  }
  const cur=document.querySelector('.pg.on');
  if(cur&&cur.id==='pg-admin-recs'){
    const bk=mkBtn('â—€ Ø±Ø¬ÙˆØ¹',backToAdmin,'tb-btn');el.insertBefore(bk,el.firstChild);
  }
}
function mkBtn(txt,fn,cls){const b=document.createElement('button');b.className=cls;b.textContent=txt;b.onclick=fn;return b;}

function goPart(){
  go('pg-part');
  document.getElementById('welcomeName').textContent=user.name;
  switchTab('rec');
  loadMyRecs();
  refreshBadge();
  if(!localStorage.getItem('tut_p_'+user.id)){
    localStorage.setItem('tut_p_'+user.id,'1');
    setTimeout(()=>startTut('participant'),700);
  }
}

async function goAdmin(){
  go('pg-admin');
  await loadParts();
  if(!localStorage.getItem('tut_admin')){
    localStorage.setItem('tut_admin','1');
    setTimeout(()=>startTut('admin'),700);
  }
}

async function goAdminRecs(p){
  curPart=p;go('pg-admin-recs');
  document.getElementById('cName').textContent=p.name;
  document.getElementById('cPass').textContent=p.password;
  document.getElementById('contactBody').style.display='none';
  document.getElementById('contactTogBtn').textContent='Ø¹Ø±Ø¶';
  await calcTotal();
  await loadAdminRecs();
}

function backToAdmin(){curPart=null;goAdmin();}
function logout(){
  stopPreview();localStorage.removeItem('sess');
  user=null;isAdmin=false;curPart=null;go('pg-home');
}

// â•â•â•â•â•â•â•â•â•â• TABS â•â•â•â•â•â•â•â•â•â•
function switchTab(t){
  document.getElementById('tab-rec').classList.toggle('on',t==='rec');
  document.getElementById('tab-msg').classList.toggle('on',t==='msg');
  document.getElementById('secRec').style.display=t==='rec'?'block':'none';
  document.getElementById('secMsg').style.display=t==='msg'?'block':'none';
  if(t==='rec'&&mrType==='video'&&!previewStream)startPreview();
  if(t==='msg'){stopPreview();loadAllMsgs();markRead();}
}

// â•â•â•â•â•â•â•â•â•â• SAVED BANNER â•â•â•â•â•â•â•â•â•â•
function checkSavedBanner(){
  const c=loadCreds();
  const b=document.getElementById('savedBanner');
  if(c){b.style.display='block';document.getElementById('savedName').textContent='Ù…Ø±Ø­Ø¨Ø§Ù‹ '+c.n+' ğŸ‘‹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­ÙÙˆØ¸Ø©!';}
  else b.style.display='none';
}

// â•â•â•â•â•â•â•â•â•â• FORMS â•â•â•â•â•â•â•â•â•â•
function togglePw(id,el){const i=document.getElementById(id);i.type=i.type==='password'?'text':'password';el.textContent=i.type==='password'?'ğŸ‘ï¸':'ğŸ™ˆ';}
function showErr(id,msg){const e=document.getElementById(id);e.textContent=msg;e.classList.add('on');setTimeout(()=>e.classList.remove('on'),3000);}

document.getElementById('regForm').onsubmit=async function(e){
  e.preventDefault();
  const n=document.getElementById('regName').value.trim();
  const p=document.getElementById('regPass').value.trim();
  if(!n||!p)return;
  showLoader();
  try{
    const snap=await window.G(window.R(window.DB,'participants'));
    if(snap.exists()&&Object.values(snap.val()).some(x=>x.name===n)){hideLoader();alert('Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹!');return;}
    const id=Date.now().toString();
    const obj={name:n,password:p,registeredAt:new Date().toISOString(),recordings:[]};
    await window.S(window.R(window.DB,'participants/'+id),obj);
    user={id,...obj};
    saveCreds(n,p);
    localStorage.setItem('sess',JSON.stringify({u:id}));
    hideLoader();goPart();
  }catch(err){hideLoader();alert('Ø®Ø·Ø£: '+err.message);}
};

document.getElementById('loginForm').onsubmit=async function(e){
  e.preventDefault();
  const n=document.getElementById('loginName').value;
  const p=document.getElementById('loginPass').value;
  showLoader();
  const snap=await window.G(window.R(window.DB,'participants'));
  hideLoader();
  if(snap.exists()){
    let f=null,fi=null;
    Object.entries(snap.val()).forEach(([id,px])=>{if(px.name===n&&px.password===p){f=px;fi=id;}});
    if(f){
      user={id:fi,...f};
      if(document.getElementById('remMe').checked) saveCreds(n,p);
      localStorage.setItem('sess',JSON.stringify({u:fi}));
      goPart();return;
    }
  }
  showErr('loginErr','Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!');
};

document.getElementById('adminForm').onsubmit=function(e){
  e.preventDefault();
  if(document.getElementById('adminPass').value==='Qur@n2025#Admin$Ramadan'){
    isAdmin=true;localStorage.setItem('sess',JSON.stringify({a:true}));goAdmin();
  }else showErr('adminErr','ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!');
};

// â•â•â•â•â•â•â•â•â•â• RECORDING â•â•â•â•â•â•â•â•â•â•
function selType(t){
  mrType=t;
  document.getElementById('tc-audio').classList.toggle('on',t==='audio');
  document.getElementById('tc-video').classList.toggle('on',t==='video');
  if(t==='video')startPreview();else stopPreview();
}
async function startPreview(){
  try{
    if(previewStream)return;
    const s=await navigator.mediaDevices.getUserMedia({video:true,audio:false});
    previewStream=s;
    document.getElementById('liveVid').srcObject=s;
    document.getElementById('liveBox').classList.add('on');
  }catch(e){alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: '+e.message);}
}
function stopPreview(){
  if(!previewStream)return;
  previewStream.getTracks().forEach(t=>t.stop());previewStream=null;
  const v=document.getElementById('liveVid');if(v.srcObject)v.srcObject=null;
  document.getElementById('liveBox').classList.remove('on','rec');
  document.getElementById('recBadge').classList.remove('on');
}
async function startRec(){
  try{
    let s;
    if(mrType==='video'){
      if(previewStream){const a=await navigator.mediaDevices.getUserMedia({audio:true});s=new MediaStream([...previewStream.getVideoTracks(),...a.getAudioTracks()]);}
      else{s=await navigator.mediaDevices.getUserMedia({video:true,audio:true});previewStream=s;document.getElementById('liveVid').srcObject=s;document.getElementById('liveBox').classList.add('on');}
    }else s=await navigator.mediaDevices.getUserMedia({audio:true});
    mrC=[];mr=new MediaRecorder(s);
    mr.ondataavailable=e=>{if(e.data.size>0)mrC.push(e.data);};
    mr.onstop=()=>{if(mrType==='audio')s.getTracks().forEach(t=>t.stop());showPrev();};
    mr.start();
    document.getElementById('startBtn').style.display='none';
    document.getElementById('stopBtn').style.display='flex';
    document.getElementById('bigTimer').classList.add('on');
    if(mrType==='video'){document.getElementById('liveBox').classList.add('rec');document.getElementById('recBadge').classList.add('on');}
    mrStart=Date.now();
    mrTimer=setInterval(()=>{
      const sec=Math.floor((Date.now()-mrStart)/1000);
      document.getElementById('bigTimer').textContent=pad(Math.floor(sec/60))+':'+pad(sec%60);
    },1000);
  }catch(e){alert('Ø®Ø·Ø£: '+e.message);}
}
function stopRec(){
  if(mr&&mr.state!=='inactive'){mr.stop();clearInterval(mrTimer);}
  document.getElementById('liveBox').classList.remove('rec');
  document.getElementById('recBadge').classList.remove('on');
  document.getElementById('stopBtn').style.display='none';
  document.getElementById('bigTimer').classList.remove('on');
}
function cancelRec(){
  mrC=[];
  document.getElementById('prevBox').classList.remove('on');
  document.getElementById('startBtn').style.display='flex';
  document.getElementById('bigTimer').textContent='00:00';
}
function showPrev(){
  const blob=new Blob(mrC,{type:mrType==='video'?'video/webm':'audio/webm'});
  const url=URL.createObjectURL(blob);
  document.getElementById('prevMedia').innerHTML=mrType==='video'
    ?`<video controls src="${url}"></video>`
    :`<audio controls src="${url}"></audio>`;
  document.getElementById('prevBox').classList.add('on');
  document.getElementById('startBtn').style.display='flex';
}
async function saveRec(){
  showLoader();
  try{
    const blob=new Blob(mrC,{type:mrType==='video'?'video/webm':'audio/webm'});
    const d=await toB64(blob);
    const id=Date.now().toString();
    const rec={id,type:mrType,data:d,timestamp:new Date().toISOString()};
    const recs=[...(user.recordings||[]),rec];
    await window.U(window.R(window.DB),{[`participants/${user.id}/recordings`]:recs});
    user.recordings=recs;
    hideLoader();
    document.getElementById('prevBox').classList.remove('on');
    mrC=[];document.getElementById('bigTimer').textContent='00:00';
    loadMyRecs();
    toast('ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡! âœ…');
  }catch(e){hideLoader();alert('Ø®Ø·Ø£: '+e.message);}
}

// â•â•â•â•â•â•â•â•â•â• MY RECS + MESSAGES COMBINED â•â•â•â•â•â•â•â•â•â•
async function loadMyRecs(){
  const div=document.getElementById('myRecsList');
  if(!user.recordings||!user.recordings.length){
    div.innerHTML='<div class="empty"><div class="ei">ğŸ™ï¸</div><p>Ù„Ù… ØªØ³Ø¬Ù‘Ù„ÙŠ Ø¨Ø¹Ø¯<br>Ø§Ø¨Ø¯Ø£ÙŠ Ø£ÙˆÙ„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¢Ù†!</p></div>';
    return;
  }
  // Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
  const snap=await window.G(window.R(window.DB,'messages'));
  const mMap={};
  if(snap.exists()){
    snap.forEach(c=>{
      const m=c.val();
      if(m.participantId===user.id){
        if(!mMap[m.recordingId])mMap[m.recordingId]=[];
        mMap[m.recordingId].push({id:c.key,...m});
      }
    });
  }
  let html='';
  user.recordings.forEach((rec,i)=>{
    const msgs=mMap[rec.id]||[];
    const hasNew=msgs.some(m=>!m.read);
    html+=`<div class="rec-card">
      <div class="rec-card-top">
        <span class="rec-num">${hasNew?'ğŸ”” ':''}ØªØ³Ø¬ÙŠÙ„ ${i+1}</span>
        <span class="rec-type">${rec.type==='video'?'ğŸ¥ ÙÙŠØ¯ÙŠÙˆ':'ğŸ¤ ØµÙˆØª'}</span>
      </div>
      <div class="rec-date">ğŸ“… ${fmtDate(rec.timestamp)}</div>
      <div class="rec-media">
        ${rec.type==='video'?`<video controls src="${rec.data}"></video>`:`<audio controls src="${rec.data}"></audio>`}
      </div>`;
    if(msgs.length){
      msgs.sort((a,b)=>new Date(a.timestamp)-new Date(b.timestamp));
      html+=`<div class="msgs-area">
        <div class="msgs-area-title">ğŸ’¬ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø§Ø³ØªØ§Ø°Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div>`;
      msgs.forEach(m=>{
        html+=`<div class="msg-item${!m.read?' new-msg':''}">
          <div class="msg-meta">
            <span class="msg-label${!m.read?' red':''}">${m.messageType==='voice'?'ğŸ¤ ØµÙˆØªÙŠØ©':m.messageType==='rating'?'â­ ØªÙ‚ÙŠÙŠÙ…':'âœ‰ï¸ Ø±Ø³Ø§Ù„Ø©'}${!m.read?'<span class="new-indicator"></span>':''}</span>
            <span class="msg-date">${fmtDate(m.timestamp)}</span>
          </div>
          <div class="msg-body">${m.message}</div>
          ${m.messageType==='voice'&&m.voiceData?`<div class="msg-audio"><audio controls src="${m.voiceData}"></audio></div>`:''}
          ${m.messageType==='rating'&&m.rating?`<div class="msg-rating-box"><div class="msg-stars">${starsHtml(m.rating)}</div><div class="msg-score">${m.rating} / 5</div></div>`:''}
        </div>`;
      });
      html+='</div>';
    }
    html+=`<button class="rec-del-btn" onclick="confirmDel('${rec.id}',false)">ğŸ—‘ï¸ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
    </div>`;
  });
  div.innerHTML=html;
}

// â•â•â•â•â•â•â•â•â•â• ALL MESSAGES TAB â•â•â•â•â•â•â•â•â•â•
async function loadAllMsgs(){
  const div=document.getElementById('allMsgsList');
  const snap=await window.G(window.R(window.DB,'messages'));
  if(!snap.exists()){div.innerHTML='<div class="empty"><div class="ei">ğŸ“­</div><p>Ù„Ø§ Ø±Ø³Ø§Ø¦Ù„</p></div>';return;}
  const msgs=[];
  snap.forEach(c=>{const m=c.val();if(m.participantId===user.id)msgs.push({id:c.key,...m});});
  if(!msgs.length){div.innerHTML='<div class="empty"><div class="ei">ğŸ“­</div><p>Ù„Ø§ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯</p></div>';return;}
  msgs.sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp));
  div.innerHTML=msgs.map(m=>`
    <div class="msg-item${!m.read?' new-msg':''}" style="margin-bottom:10px;">
      <div class="msg-meta">
        <span class="msg-label${!m.read?' red':''}">${m.messageType==='voice'?'ğŸ¤ ØµÙˆØªÙŠØ©':m.messageType==='rating'?'â­ ØªÙ‚ÙŠÙŠÙ…':'âœ‰ï¸ Ø±Ø³Ø§Ù„Ø©'}</span>
        <span class="msg-date">${fmtDate(m.timestamp)}</span>
      </div>
      <div class="msg-body">${m.message}</div>
      ${m.messageType==='voice'&&m.voiceData?`<div class="msg-audio"><audio controls src="${m.voiceData}"></audio></div>`:''}
      ${m.messageType==='rating'&&m.rating?`<div class="msg-rating-box"><div class="msg-stars">${starsHtml(m.rating)}</div><div class="msg-score">${m.rating} / 5</div></div>`:''}
    </div>`).join('');
}

async function refreshBadge(){
  const snap=await window.G(window.R(window.DB,'messages'));
  let c=0;
  if(snap.exists())snap.forEach(x=>{const m=x.val();if(m.participantId===user.id&&!m.read)c++;});
  const d=document.getElementById('unreadDot');
  if(c>0){d.textContent=c;d.style.display='flex';}else d.style.display='none';
}
async function markRead(){
  const snap=await window.G(window.R(window.DB,'messages'));
  if(!snap.exists())return;
  const upd={};
  snap.forEach(c=>{const m=c.val();if(m.participantId===user.id&&!m.read)upd[`messages/${c.key}/read`]=true;});
  if(Object.keys(upd).length)await window.U(window.R(window.DB),upd);
  refreshBadge();
  setTimeout(loadMyRecs,500);
}

// â•â•â•â•â•â•â•â•â•â• ADMIN â•â•â•â•â•â•â•â•â•â•
async function loadParts(){
  showLoader();
  const snap=await window.G(window.R(window.DB,'participants'));
  hideLoader();
  const grid=document.getElementById('partGrid');
  if(!snap.exists()){grid.innerHTML='<div class="empty" style="grid-column:1/-1"><div class="ei">ğŸ‘¥</div><p>Ù„Ø§ Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø¨Ø¹Ø¯</p></div>';stSt(0,0,0);return;}
  let parts=[],tr=0,nr=0;
  snap.forEach(c=>parts.push({id:c.key,...c.val()}));
  parts.forEach(p=>{const r=p.recordings||[];tr+=r.length;r.forEach(rc=>{if(!isV(p.id,rc.id))nr++;});});
  stSt(parts.length,tr,nr);
  grid.innerHTML=parts.map(p=>{
    const nc=(p.recordings||[]).filter(r=>!isV(p.id,r.id)).length;
    return `<div class="part-card" onclick='goAdminRecs(${JSON.stringify(p)})'>
      ${nc?`<div class="new-bubble">${nc}</div>`:''}
      <div class="part-card-icon">ğŸ‘¤</div>
      <div class="part-card-name">${p.name}</div>
      <div class="part-card-count">${(p.recordings||[]).length} ØªØ³Ø¬ÙŠÙ„</div>
    </div>`;
  }).join('');
}
function stSt(p,r,n){document.getElementById('stN').textContent=p;document.getElementById('stR').textContent=r;document.getElementById('stNew').textContent=n;}

async function loadAdminRecs(){
  const div=document.getElementById('adminRecsList');
  if(!curPart.recordings||!curPart.recordings.length){div.innerHTML='<div class="empty"><div class="ei">ğŸ™ï¸</div><p>Ù„Ø§ ØªØ³Ø¬ÙŠÙ„Ø§Øª</p></div>';return;}
  const snap=await window.G(window.R(window.DB,'messages'));
  const mMap={};
  if(snap.exists()){snap.forEach(c=>{const m=c.val();if(m.participantId===curPart.id){if(!mMap[m.recordingId])mMap[m.recordingId]=[];mMap[m.recordingId].push({id:c.key,...m});}});}
  curPart.recordings.forEach(r=>markV(curPart.id,r.id));
  div.innerHTML=curPart.recordings.map((rec,i)=>{
    const msgs=(mMap[rec.id]||[]).sort((a,b)=>new Date(a.timestamp)-new Date(b.timestamp));
    return `<div class="rec-card">
      <div class="rec-card-top">
        <span class="rec-num">ØªØ³Ø¬ÙŠÙ„ ${i+1}</span>
        <span class="rec-type">${rec.type==='video'?'ğŸ¥ ÙÙŠØ¯ÙŠÙˆ':'ğŸ¤ ØµÙˆØª'}</span>
      </div>
      <div class="rec-date">ğŸ“… ${fmtDate(rec.timestamp)}</div>
      <div class="rec-media">
        ${rec.type==='video'?`<video controls src="${rec.data}"></video>`:`<audio controls src="${rec.data}"></audio>`}
      </div>
      ${msgs.length?`<div class="msgs-area">
        <div class="msgs-area-title">ğŸ’¬ Ø±Ø³Ø§Ø¦Ù„ Ù…Ø±Ø³Ù„Ø©</div>
        ${msgs.map(m=>`<div class="msg-item">
          <div class="msg-meta"><span class="msg-label">${m.messageType==='voice'?'ğŸ¤':m.messageType==='rating'?'â­':'âœ‰ï¸'}</span><span class="msg-date">${fmtDate(m.timestamp)}</span></div>
          <div class="msg-body">${m.message}</div>
          ${m.messageType==='voice'&&m.voiceData?`<div class="msg-audio"><audio controls src="${m.voiceData}"></audio></div>`:''}
          ${m.messageType==='rating'&&m.rating?`<div class="msg-rating-box"><div class="msg-stars">${starsHtml(m.rating)}</div><div class="msg-score">${m.rating}/5</div></div>`:''}
        </div>`).join('')}
      </div>`:''}
      <div class="rec-actions">
        <button class="rec-act-btn" onclick="openSheet('${rec.id}','text')">âœï¸ Ø±Ø³Ø§Ù„Ø©</button>
        <button class="rec-act-btn" onclick="openSheet('${rec.id}','voice')">ğŸ¤ ØµÙˆØªÙŠØ©</button>
        <button class="rec-act-btn" onclick="openSheet('${rec.id}','rating')">â­ ØªÙ‚ÙŠÙŠÙ…</button>
        <button class="rec-act-btn danger" onclick="confirmDel('${rec.id}',true)">ğŸ—‘ï¸</button>
      </div>
    </div>`;
  }).join('');
}

async function calcTotal(){
  const snap=await window.G(window.R(window.DB,'messages'));
  let tot=0,cnt=0;const rs=new Set();
  if(snap.exists())snap.forEach(c=>{const m=c.val();if(m.participantId===curPart.id&&m.messageType==='rating'&&m.rating&&!rs.has(m.recordingId)){tot+=m.rating;rs.add(m.recordingId);cnt++;}});
  const b=document.getElementById('totalBadge');
  if(!cnt){b.classList.remove('on');return;}
  b.classList.add('on');
  document.getElementById('totalVal').textContent=tot.toFixed(1);
  document.getElementById('totalMax').textContent=cnt*5;
}

function toggleContact(){
  const b=document.getElementById('contactBody'),t=document.getElementById('contactTogBtn');
  if(b.style.display==='none'){b.style.display='block';t.textContent='Ø¥Ø®ÙØ§Ø¡';}
  else{b.style.display='none';t.textContent='Ø¹Ø±Ø¶';}
}
async function copyIt(tp,btn){
  const txt=tp==='name'?curPart.name:curPart.password;
  try{await navigator.clipboard.writeText(txt);const o=btn.innerHTML;btn.innerHTML='âœ… ØªÙ…';btn.classList.add('ok');setTimeout(()=>{btn.innerHTML=o;btn.classList.remove('ok');},2000);}
  catch(e){alert('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®');}
}

// â•â•â•â•â•â•â•â•â•â• SEND MSG SHEET â•â•â•â•â•â•â•â•â•â•
function openSheet(recId,type){
  curRecMsg=recId;selRat=0;
  const el=document.createElement('div');
  el.className='sheet-bg';el.id='sht';
  el.innerHTML=`<div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-title">ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©</div>
    <div class="s-tabs">
      <button class="s-tab ${type==='text'?'on':''}" onclick="stab('text',this)">âœï¸ Ù†ØµÙŠØ©</button>
      <button class="s-tab ${type==='voice'?'on':''}" onclick="stab('voice',this)">ğŸ¤ ØµÙˆØªÙŠØ©</button>
      <button class="s-tab ${type==='rating'?'on':''}" onclick="stab('rating',this)">â­ ØªÙ‚ÙŠÙŠÙ…</button>
    </div>
    <div id="st-text" class="${type!=='text'?'hidden':''}">
      <textarea class="s-textarea" id="sTxt" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø±Ø³Ø§Ù„ØªÙƒ..."></textarea>
    </div>
    <div id="st-voice" class="voice-box ${type!=='voice'?'hidden':''}">
      <button class="btn btn-gold btn-mb" id="vrStart" onclick="startAVR()">ğŸ¤ Ø§Ø¨Ø¯Ø£ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
      <div class="voice-timer" id="vrTimer">00:00</div>
      <button class="btn btn-red btn-mb" id="vrStop" onclick="stopAVR()" style="display:none;">â¹ Ø¥ÙŠÙ‚Ø§Ù</button>
      <div id="vrPrev" style="display:none;"><audio id="vrAudio" controls style="width:100%;border-radius:8px;margin-top:8px;"></audio></div>
    </div>
    <div id="st-rating" class="rating-box ${type!=='rating'?'hidden':''}">
      <p style="font-weight:700;color:var(--g);margin-bottom:4px;">Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
      <div class="stars-row" id="sStars">${[1,2,3,4,5].map(i=>`<span class="star" onclick="setRat(${i})" data-v="${i}">â˜†</span>`).join('')}</div>
      <div class="rat-val" id="ratVal">0 / 5</div>
      <div class="rat-grid">${[0.5,1,1.5,2,2.5,3,3.5,4,4.5,5].map(v=>`<button class="rat-btn" onclick="setRat(${v})">${v}</button>`).join('')}</div>
    </div>
    <div class="sheet-btns">
      <button class="btn btn-gold" onclick="sendMsg()">Ø¥Ø±Ø³Ø§Ù„ âœ…</button>
      <button class="btn btn-ghost" onclick="closeSheet()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>`;
  document.body.appendChild(el);
  el.addEventListener('click',e=>{if(e.target===el)closeSheet();});
}
function stab(t,btn){
  document.querySelectorAll('.s-tab').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  ['text','voice','rating'].forEach(id=>{const el=document.getElementById('st-'+id);if(el)el.className=el.className.replace(' hidden','')+(id!==t?' hidden':'');});
}
function setRat(v){
  selRat=v;
  document.getElementById('ratVal').textContent=v+' / 5';
  document.querySelectorAll('#sStars .star').forEach((s,i)=>{s.textContent=v>=i+1?'â­':'â˜†';});
  document.querySelectorAll('.rat-btn').forEach(b=>{b.classList.toggle('on',parseFloat(b.textContent)===v);});
}
async function startAVR(){
  try{
    const s=await navigator.mediaDevices.getUserMedia({audio:true});
    avrC=[];avr=new MediaRecorder(s);
    avr.ondataavailable=e=>{if(e.data.size>0)avrC.push(e.data);};
    avr.onstop=()=>{
      s.getTracks().forEach(t=>t.stop());
      const blob=new Blob(avrC,{type:'audio/webm'});
      document.getElementById('vrAudio').src=URL.createObjectURL(blob);
      document.getElementById('vrPrev').style.display='block';
    };
    avr.start();
    document.getElementById('vrStart').style.display='none';
    document.getElementById('vrStop').style.display='flex';
    document.getElementById('vrTimer').classList.add('on');
    const t0=Date.now();
    avrTimer=setInterval(()=>{const s2=Math.floor((Date.now()-t0)/1000);document.getElementById('vrTimer').textContent=pad(Math.floor(s2/60))+':'+pad(s2%60);},1000);
  }catch(e){alert('Ø®Ø·Ø£: '+e.message);}
}
function stopAVR(){
  if(avr&&avr.state!=='inactive'){avr.stop();clearInterval(avrTimer);}
  document.getElementById('vrStart').style.display='flex';
  document.getElementById('vrStop').style.display='none';
  document.getElementById('vrTimer').classList.remove('on');
}
function closeSheet(){
  document.getElementById('sht')?.remove();
  avrC=[];if(avr&&avr.state!=='inactive')avr.stop();clearInterval(avrTimer);selRat=0;
}
async function sendMsg(){
  const at=document.querySelector('.s-tab.on');
  let type='text';
  if(at.textContent.includes('ØµÙˆØªÙŠØ©'))type='voice';
  else if(at.textContent.includes('ØªÙ‚ÙŠÙŠÙ…'))type='rating';
  showLoader();
  try{
    if(type==='text'){
      const t=document.getElementById('sTxt').value.trim();
      if(!t){hideLoader();alert('Ø§ÙƒØªØ¨ÙŠ Ø±Ø³Ø§Ù„Ø©!');return;}
      await doSend(curPart.id,curRecMsg,t,'text',null,null);
    }else if(type==='voice'){
      if(!avrC.length){hideLoader();alert('Ø³Ø¬Ù‘Ù„ÙŠ Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ©!');return;}
      const d=await toB64(new Blob(avrC,{type:'audio/webm'}));
      await doSend(curPart.id,curRecMsg,'ğŸ¤ Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ©','voice',d,null);
    }else{
      if(!selRat){hideLoader();alert('Ø§Ø®ØªØ§Ø±ÙŠ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹!');return;}
      const snap=await window.G(window.R(window.DB,'messages'));
      if(snap.exists()){const upd={};snap.forEach(c=>{const m=c.val();if(m.recordingId===curRecMsg&&m.participantId===curPart.id&&m.messageType==='rating')upd['messages/'+c.key]=null;});if(Object.keys(upd).length)await window.U(window.R(window.DB),upd);}
      await doSend(curPart.id,curRecMsg,`â­ ØªÙ‚ÙŠÙŠÙ…Ùƒ: ${selRat} / 5 Ù†Ø¬ÙˆÙ…`,'rating',null,selRat);
    }
    hideLoader();closeSheet();await calcTotal();await loadAdminRecs();toast('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„! âœ…');
  }catch(e){hideLoader();alert('Ø®Ø·Ø£: '+e.message);}
}
async function doSend(pid,rid,msg,type,voice,rating){
  const r=window.P(window.R(window.DB,'messages'));
  const obj={participantId:pid,recordingId:rid,message:msg,messageType:type,timestamp:new Date().toISOString(),read:false};
  if(voice)obj.voiceData=voice;if(rating)obj.rating=rating;
  await window.S(r,obj);
}

// â•â•â•â•â•â•â•â•â•â• DELETE â•â•â•â•â•â•â•â•â•â•
function confirmDel(recId,adminMode){
  const el=document.createElement('div');
  el.className='confirm-bg';
  el.innerHTML=`<div class="confirm-box">
    <div class="confirm-em">ğŸ—‘ï¸</div>
    <div class="confirm-ttl">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</div>
    <div class="confirm-desc">Ù‡Ù„ Ø£Ù†ØªÙ Ù…ØªØ£ÙƒØ¯Ø©ØŸ Ù„Ù† ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹.</div>
    <div class="confirm-btns">
      <button class="btn btn-red" onclick="doDel('${recId}',${adminMode})">Ø­Ø°Ù</button>
      <button class="btn btn-ghost" onclick="this.closest('.confirm-bg').remove()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>`;
  document.body.appendChild(el);
  el.addEventListener('click',e=>{if(e.target===el)el.remove();});
}
async function doDel(recId,adminMode){
  showLoader();
  const src=adminMode?curPart:user;
  const pid=adminMode?curPart.id:user.id;
  const recs=(src.recordings||[]).filter(r=>r.id!==recId);
  await window.U(window.R(window.DB),{[`participants/${pid}/recordings`]:recs});
  const snap=await window.G(window.R(window.DB,'messages'));
  if(snap.exists()){const upd={};snap.forEach(c=>{if(c.val().recordingId===recId)upd['messages/'+c.key]=null;});if(Object.keys(upd).length)await window.U(window.R(window.DB),upd);}
  if(adminMode){curPart.recordings=recs;await calcTotal();await loadAdminRecs();}
  else{user.recordings=recs;loadMyRecs();refreshBadge();}
  hideLoader();document.querySelector('.confirm-bg')?.remove();toast('ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…');
}

// â•â•â•â•â•â•â•â•â•â• HELPERS â•â•â•â•â•â•â•â•â•â•
function toB64(blob){return new Promise((res,rej)=>{const fr=new FileReader();fr.onloadend=()=>res(fr.result);fr.onerror=rej;fr.readAsDataURL(blob);});}
function pad(n){return String(n).padStart(2,'0');}
function fmtDate(ts){return new Date(ts).toLocaleDateString('ar-SA');}
function starsHtml(r){let h='';for(let i=1;i<=5;i++)h+=r>=i?'â­':(r>i-1?'ğŸŒŸ':'â˜†');return h;}
function showLoader(){if(!document.getElementById('ldr')){const d=document.createElement('div');d.className='loader-bg';d.id='ldr';d.innerHTML='<div class="loader-box"><div class="loader-spin"></div><div class="loader-txt">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>';document.body.appendChild(d);}}
function hideLoader(){document.getElementById('ldr')?.remove();}
function toast(msg){const t=document.createElement('div');t.className='toast';t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.remove(),2600);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ SPOTLIGHT TUTORIAL â€” CLEAN REBUILD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let tSteps=[],tIdx=0;

const TUT_PART=[
  {sel:'#welcomeBanner',ttl:'Ù‡Ø°Ø§ Ø¨Ø§Ù†Ø± Ø§Ù„ØªØ±Ø­ÙŠØ¨ ğŸ‘‹',desc:'Ø§Ø³Ù…Ùƒ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ ÙÙŠ ÙƒÙ„ Ù…Ø±Ø© ØªØ¯Ø®Ù„ÙŠÙ†. Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©!',tip:null},
  {sel:'#partTabs',ttl:'Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ğŸ“‚',desc:'"ØªØ³Ø¬ÙŠÙ„" Ù„Ø¥Ø±Ø³Ø§Ù„ Ø­ÙØ¸Ùƒ ÙˆØ±Ø¤ÙŠØ© Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ§Ø°Ø© Ù…Ø¨Ø§Ø´Ø±Ø© ØªØ­ØªÙ‡ØŒ Ùˆ"Ø±Ø³Ø§Ø¦Ù„ÙŠ" Ù„ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„.',tip:'ğŸ”” Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ = Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø§Ø³ØªØ§Ø°Ø©'},
  {sel:'#typeGrid',ttl:'Ø§Ø®ØªØ§Ø±ÙŠ Ù†ÙˆØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ğŸ¤',desc:'ØµÙˆØª ÙÙ‚Ø· Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ â€” Ø£Ù†ØªÙ ØªØ®ØªØ§Ø±ÙŠÙ†!',tip:null},
  {sel:'#startBtn',ttl:'Ø§Ø¨Ø¯Ø£ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„! ğŸ”´',desc:'Ø§Ø¶ØºØ·ÙŠ Ù‡Ù†Ø§ Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ØŒ Ø«Ù… "Ø¥ÙŠÙ‚Ø§Ù" Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ØŒ Ø«Ù… "Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„".',tip:'ğŸ’¡ Ø³ØªØ¸Ù‡Ø± Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„'},
];

const TUT_ADMIN=[
  {sel:null,ttl:'Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ğŸ‘©â€ğŸ«',desc:'Ù…Ù† Ù‡Ù†Ø§ ØªØªØ§Ø¨Ø¹ÙŠÙ† ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙˆØªØ³Ø¬ÙŠÙ„Ø§ØªÙ‡Ù… ÙˆØªØ±Ø¯Ù‘ÙŠÙ† Ø¹Ù„ÙŠÙ‡Ù… Ø¨Ø³Ù‡ÙˆÙ„Ø©.',tip:null},
  {sel:'#stNew',ttl:'Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ğŸ†•',desc:'Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… ÙŠØ®Ø¨Ø±Ùƒ Ø¨ØªØ³Ø¬ÙŠÙ„Ø§Øª Ù„Ù… ØªØ´Ø§Ù‡Ø¯ÙŠÙ‡Ø§ Ø¨Ø¹Ø¯.',tip:null},
  {sel:'#partGrid',ttl:'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ğŸ‘¥',desc:'Ø§Ø¶ØºØ·ÙŠ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø£ÙŠ Ù…Ø´Ø§Ø±Ùƒ Ù„ØªØ±ÙŠ ØªØ³Ø¬ÙŠÙ„Ø§ØªÙ‡Ø§ ÙˆØªØ±Ø³Ù„ÙŠ Ø±Ø³Ø§Ø¦Ù„Ùƒ.',tip:'ğŸ”´ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£Ø­Ù…Ø± = ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù… ØªÙØ´Ø§Ù‡ÙØ¯'},
];

function startTut(mode){
  tSteps=mode==='participant'?TUT_PART:TUT_ADMIN;
  tIdx=0;
  document.getElementById('tutBg').classList.add('on');
  renderTutStep();
}

function renderTutStep(){
  const s=tSteps[tIdx],total=tSteps.length;
  const card=document.getElementById('tutCard');

  // fill content
  document.getElementById('tutNum').textContent=`Ø®Ø·ÙˆØ© ${tIdx+1} Ù…Ù† ${total}`;
  document.getElementById('tutTtl').textContent=s.ttl;
  document.getElementById('tutDesc').textContent=s.desc;
  const tip=document.getElementById('tutTip');
  if(s.tip){tip.textContent=s.tip;tip.style.display='block';}else tip.style.display='none';

  // dots
  document.getElementById('tutDots').innerHTML=tSteps.map((_,i)=>`<div class="tut-dot${i===tIdx?' on':''}"></div>`).join('');

  // btns
  document.getElementById('tutPrev').style.display=tIdx>0?'block':'none';
  document.getElementById('tutNext').textContent=tIdx===total-1?'âœ… ÙÙ‡Ù…Øª!':'Ø§Ù„ØªØ§Ù„ÙŠ â–¶';

  // hide card while positioning
  card.classList.remove('visible','arr-up','arr-down','arr-none');

  // position
  if(!s.sel){
    posCenter();return;
  }
  const el=document.querySelector(s.sel);
  if(!el){posCenter();return;}

  el.scrollIntoView({behavior:'smooth',block:'center'});
  setTimeout(()=>posOnEl(el),200);
}

function posCenter(){
  const card=document.getElementById('tutCard');
  const ring=document.getElementById('tutRing');
  const svg=document.getElementById('tutSvg');
  ring.style.display='none';
  svg.innerHTML=`<rect width="100%" height="100%" fill="rgba(10,18,26,0.82)"/>`;
  const vw=window.innerWidth,vh=window.innerHeight;
  const cw=Math.min(300,vw-28);
  card.style.cssText=`width:${cw}px;left:${(vw-cw)/2}px;top:${(vh-200)/2}px;`;
  card.classList.add('arr-none','visible');
  // draw dark mask on SVG - no cutout
  drawSvgMask(null);
}

function posOnEl(el){
  const card=document.getElementById('tutCard');
  const ring=document.getElementById('tutRing');
  const r=el.getBoundingClientRect();
  const pad=10;
  const vw=window.innerWidth,vh=window.innerHeight;
  // draw SVG mask with cutout
  drawSvgMask({x:r.left-pad,y:r.top-pad,w:r.width+pad*2,h:r.height+pad*2});
  // ring
  ring.style.cssText=`display:block;left:${r.left-pad}px;top:${r.top-pad}px;width:${r.width+pad*2}px;height:${r.height+pad*2}px;`;
  // card width
  const cw=Math.min(300,vw-28);
  card.style.width=cw+'px';
  // position: prefer below, fallback above
  const spaceBelow=vh-r.bottom-pad;
  const spaceAbove=r.top-pad;
  let ct,cl,arrow;
  if(spaceBelow>=170){
    ct=r.bottom+pad+14;arrow='arr-up';
  }else{
    ct=r.top-pad-14-190;arrow='arr-down';
  }
  cl=Math.max(14,Math.min(r.left+(r.width-cw)/2,vw-cw-14));
  ct=Math.max(64,Math.min(ct,vh-200));
  card.style.left=cl+'px';
  card.style.top=ct+'px';
  card.classList.add(arrow,'visible');
}

function drawSvgMask(cut){
  const svg=document.getElementById('tutSvg');
  if(!cut){
    svg.innerHTML=`<rect width="100%" height="100%" fill="rgba(10,18,26,0.82)"/>`;
    return;
  }
  svg.innerHTML=`
    <defs>
      <mask id="cm">
        <rect width="100%" height="100%" fill="white"/>
        <rect x="${cut.x}" y="${cut.y}" width="${cut.w}" height="${cut.h}" rx="12" fill="black"/>
      </mask>
    </defs>
    <rect width="100%" height="100%" fill="rgba(10,18,26,0.82)" mask="url(#cm)"/>
    <rect x="${cut.x}" y="${cut.y}" width="${cut.w}" height="${cut.h}" rx="12"
          fill="none" stroke="rgba(200,152,42,0.9)" stroke-width="2.5"/>`;
}

function tNext(){if(tIdx<tSteps.length-1){tIdx++;renderTutStep();}else tSkip();}
function tPrev(){if(tIdx>0){tIdx--;renderTutStep();}}
function tSkip(){
  const bg=document.getElementById('tutBg');
  bg.classList.remove('on');
  // clean up
  document.getElementById('tutSvg').innerHTML='';
  document.getElementById('tutRing').style.display='none';
  document.getElementById('tutCard').classList.remove('visible','arr-up','arr-down','arr-none');
}

// â•â•â•â•â•â•â•â•â•â• REGISTER TUTORIAL (inline) â•â•â•â•â•â•â•â•â•â•
const RT=[
  {ttl:'ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹! Ø¯Ø¹ÙŠÙ†Ø§ Ù†Ø³Ø§Ø¹Ø¯Ùƒ',desc:'Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø³Ù‡Ù„ Ø¬Ø¯Ø§Ù‹ â€” Ø®Ø·ÙˆØªØ§Ù† ÙÙ‚Ø·! Ø§Ù‚Ø±Ø¦ÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø´Ø±Ø­ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ø¨Ø¯Ø£ÙŠ.'},
  {ttl:'ğŸ“ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ø§Ø³Ù…',desc:'Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…Ùƒ ÙƒØ§Ù…Ù„Ø§Ù‹ ÙƒÙ…Ø§ ØªØ¹Ø±ÙÙŠÙ†Ù‡ØŒ Ù…Ø«Ù„Ø§Ù‹: "ÙØ§Ø·Ù…Ø© Ø£Ø­Ù…Ø¯". Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø°ÙŠ Ø³ØªØ¯Ø®Ù„ÙŠÙ† Ø¨Ù‡ ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©.',target:'rg-name'},
  {ttl:'ğŸ” Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',desc:'Ø§Ø®ØªØ§Ø±ÙŠ Ø±Ù‚Ù…Ø§Ù‹ Ø³Ù‡Ù„Ø§Ù‹ ØªØ­ÙØ¸ÙŠÙ†Ù‡ØŒ Ù…Ø«Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ø£Ùˆ ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯Ùƒ. Ø§ÙƒØªØ¨ÙŠÙ‡ ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù†!',target:'rg-pass'},
];
let rtIdx=0;

function initRegTut(){
  rtIdx=0;
  if(localStorage.getItem('rt_done')) return; // Ø³Ø¨Ù‚ ÙˆØ´Ø§Ù‡Ø¯Øª
  document.getElementById('regTut').classList.add('on');
  renderRT();
}
function renderRT(){
  const s=RT[rtIdx];
  document.getElementById('rtStep').textContent=`Ø®Ø·ÙˆØ© ${rtIdx+1} Ù…Ù† ${RT.length}`;
  document.getElementById('rtTitle').textContent=s.ttl;
  document.getElementById('rtDesc').textContent=s.desc;
  // dots
  document.getElementById('rtDots').innerHTML=RT.map((_,i)=>`<div class="rt-dot${i===rtIdx?' on':''}"></div>`).join('');
  document.getElementById('rtPrev').style.display=rtIdx>0?'block':'none';
  document.getElementById('rtNext').textContent=rtIdx===RT.length-1?'âœ… Ø§Ø¨Ø¯Ø£ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„':'Ø§Ù„ØªØ§Ù„ÙŠ â–¶';
  // highlight target field
  document.querySelectorAll('.f-group').forEach(g=>g.style.outline='none');
  if(s.target){const t=document.getElementById(s.target);if(t)t.style.outline='3px solid rgba(200,152,42,0.6)';}
}
function rtNextStep(){
  if(rtIdx<RT.length-1){rtIdx++;renderRT();}
  else{
    document.getElementById('regTut').classList.remove('on');
    document.querySelectorAll('.f-group').forEach(g=>g.style.outline='none');
    localStorage.setItem('rt_done','1');
    document.getElementById('regName').focus();
  }
}
function rtPrevStep(){if(rtIdx>0){rtIdx--;renderRT();}}
</script>
</body>
</html>
