<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø­ÙØ¸ Ø¬Ø²Ø¡ Ø¹Ù… - Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;600;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary-gold: #d4af37;
        --dark-green: #0d4d3f;
        --medium-green: #1a6b54;
        --light-green: #e8f5e9;
        --cream: #fefdf8;
        --white: #ffffff;
        --text-dark: #2c2c2c;
        --border-light: #e0dfd5;
        --accent-gold: #f0c850;
      }

      body {
        font-family: "Cairo", sans-serif;
        background: linear-gradient(
          135deg,
          #0d4d3f 0%,
          #1a6b54 100%
        );
        min-height: 100vh;
        padding: 30px 20px;
        position: relative;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 50px;
      }

      .logo {
        width: 160px;
        height: 160px;
        margin: 0 auto 30px;
        background: linear-gradient(135deg, var(--primary-gold), var(--accent-gold));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        border: 4px solid rgba(255, 255, 255, 0.5);
        padding: 8px;
      }

      .logo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
      }

      h1 {
        font-family: "Amiri", serif;
        color: var(--white);
        font-size: 3.2rem;
        font-weight: 700;
        margin-bottom: 15px;
        text-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);
      }

      .subtitle {
        color: var(--primary-gold);
        font-size: 1.5rem;
        font-weight: 600;
      }

      .card {
        background: var(--white);
        border-radius: 20px;
        padding: 50px;
        box-shadow: 0 10px 50px rgba(0, 0, 0, 0.15);
        margin-bottom: 30px;
      }

      .info-box {
        background: linear-gradient(to bottom right, #fff9e6, #fefdf8);
        padding: 30px;
        border-radius: 16px;
        margin-bottom: 35px;
        border-right: 5px solid var(--primary-gold);
      }

      .info-box h3 {
        color: var(--dark-green);
        margin-bottom: 15px;
        font-size: 1.5rem;
      }

      .info-box p {
        color: var(--text-dark);
        line-height: 1.9;
        font-size: 1.1rem;
      }

      .info-box.warning {
        background: linear-gradient(to bottom right, #fff4e6, #ffe4cc);
        border-right-color: #ff9800;
      }

      .form-group {
        margin-bottom: 28px;
      }

      label {
        display: block;
        color: var(--dark-green);
        font-weight: 700;
        margin-bottom: 12px;
        font-size: 1.15rem;
      }

      input[type="text"],
      input[type="password"],
      select {
        width: 100%;
        padding: 18px 20px;
        border: 2px solid var(--border-light);
        border-radius: 12px;
        font-size: 1.1rem;
        font-family: "Cairo", sans-serif;
        transition: all 0.3s ease;
        background: var(--cream);
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: var(--primary-gold);
        background: var(--white);
      }

      .btn {
        width: 100%;
        padding: 20px;
        border: none;
        border-radius: 12px;
        font-size: 1.2rem;
        font-weight: 700;
        font-family: "Cairo", sans-serif;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--primary-gold), var(--accent-gold));
        color: var(--dark-green);
        box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.5);
      }

      .btn-secondary {
        background: var(--dark-green);
        color: var(--white);
        box-shadow: 0 4px 15px rgba(13, 77, 63, 0.3);
      }

      .btn-secondary:hover {
        background: var(--medium-green);
        transform: translateY(-2px);
      }

      .btn-record {
        background: #dc2626;
        color: white;
        margin-top: 15px;
      }

      .btn-record:hover {
        background: #b91c1c;
      }

      .btn-record.recording {
        background: #059669;
      }

      .btn-stop {
        background: #7c3aed;
        color: white;
      }

      .btn-stop:hover {
        background: #6d28d9;
      }

      .recording-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 20px;
      }

      .recording-preview {
        margin-top: 25px;
        padding: 30px;
        background: linear-gradient(to bottom, #fff9e6, var(--white));
        border-radius: 16px;
        border: 3px solid var(--primary-gold);
      }

      .recording-preview video,
      .recording-preview audio {
        width: 100%;
        border-radius: 12px;
        margin-top: 15px;
      }

      .live-preview {
        margin-top: 25px;
        padding: 20px;
        background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
        border-radius: 16px;
        border: 3px solid var(--primary-gold);
      }

      .live-preview.recording {
        background: linear-gradient(135deg, #fef3c7, #fde68a);
        border-color: #dc2626;
      }

      .live-preview video {
        width: 100%;
        border-radius: 12px;
        background: #000;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .live-preview-label {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--dark-green);
        font-weight: 700;
        margin-bottom: 15px;
        font-size: 1.15rem;
      }

      .live-indicator {
        width: 14px;
        height: 14px;
        background: #059669;
        border-radius: 50%;
        animation: blink 2s ease-in-out infinite;
        box-shadow: 0 0 10px #059669;
      }

      .live-preview.recording .live-indicator {
        background: #dc2626;
        box-shadow: 0 0 12px #dc2626;
        animation: recordingBlink 1s ease-in-out infinite;
      }

      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.4;
        }
      }

      @keyframes recordingBlink {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.5;
          transform: scale(1.1);
        }
      }

      .hidden {
        display: none !important;
      }

      .success-message {
        background: #d1fae5;
        color: #065f46;
        padding: 20px 25px;
        border-radius: 12px;
        margin-bottom: 25px;
        border-right: 5px solid #10b981;
        font-weight: 600;
        font-size: 1.05rem;
      }

      .error-message {
        background: #fee2e2;
        color: #991b1b;
        padding: 20px 25px;
        border-radius: 12px;
        margin-bottom: 25px;
        border-right: 5px solid #dc2626;
        font-weight: 600;
        font-size: 1.05rem;
      }

      .participant-item {
        background: linear-gradient(to bottom, var(--white), #fefdf8);
        padding: 35px;
        border-radius: 16px;
        margin-bottom: 30px;
        border-right: 5px solid var(--primary-gold);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }

      .participant-info {
        margin-bottom: 25px;
      }

      .participant-info h3 {
        color: var(--dark-green);
        margin-bottom: 15px;
        font-size: 1.6rem;
      }

      .participant-info p {
        color: var(--text-dark);
        margin: 8px 0;
        font-size: 1.1rem;
      }

      .recordings-list {
        display: grid;
        gap: 20px;
      }

      .recording-item {
        background: white;
        padding: 30px;
        border-radius: 14px;
        border: 2px solid var(--border-light);
        position: relative;
      }

      .recording-item:hover {
        border-color: var(--primary-gold);
      }

      .recording-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
      }

      .recording-info {
        flex: 1;
      }

      .delete-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.8rem;
        color: #999;
        padding: 5px 10px;
        transition: all 0.3s ease;
        line-height: 1;
      }

      .delete-btn:hover {
        color: #dc2626;
        transform: scale(1.2);
      }

      .recording-item video,
      .recording-item audio {
        width: 100%;
        margin-top: 15px;
        border-radius: 12px;
      }

      .logout-btn {
        position: fixed;
        top: 25px;
        left: 25px;
        background: rgba(255, 255, 255, 0.95);
        color: var(--dark-green);
        padding: 12px 28px;
        border: 2px solid var(--primary-gold);
        border-radius: 25px;
        cursor: pointer;
        font-weight: 700;
        font-size: 1.05rem;
        transition: all 0.3s ease;
        z-index: 1000;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
      }

      .logout-btn:hover {
        background: var(--primary-gold);
        color: var(--white);
        transform: translateY(-2px);
      }

      .timer {
        text-align: center;
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--dark-green);
        margin: 20px 0;
        font-family: "Courier New", monospace;
      }

      .choose-type {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
      }

      .type-option {
        padding: 35px;
        border: 3px solid var(--border-light);
        border-radius: 16px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s ease;
        background: var(--cream);
      }

      .type-option:hover {
        border-color: var(--primary-gold);
        transform: translateY(-3px);
      }

      .type-option.selected {
        border-color: var(--primary-gold);
        background: linear-gradient(to bottom right, #fff9e6, var(--cream));
      }

      .type-option .icon {
        font-size: 3rem;
        margin-bottom: 15px;
      }

      .type-option h3 {
        color: var(--dark-green);
        font-size: 1.25rem;
        font-weight: 700;
      }

      .admin-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
      }

      .stat-card {
        background: linear-gradient(135deg, var(--dark-green), var(--medium-green));
        padding: 40px;
        border-radius: 16px;
        color: white;
        text-align: center;
        box-shadow: 0 6px 25px rgba(13, 77, 63, 0.3);
      }

      .stat-card .number {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 10px;
      }

      .stat-card .label {
        font-size: 1.15rem;
        opacity: 0.95;
      }

      .unread-badge {
        position: absolute;
        top: -10px;
        left: -10px;
        background: #dc2626;
        color: white;
        border-radius: 50%;
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        font-weight: 700;
        box-shadow: 0 2px 8px rgba(220, 38, 38, 0.4);
      }

      .message-item {
        background: linear-gradient(135deg, #fff9e6, var(--white));
        padding: 30px;
        border-radius: 16px;
        margin-bottom: 25px;
        border-right: 5px solid var(--primary-gold);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      }

      .message-item.unread {
        background: linear-gradient(135deg, #fff4d6, #fff9e6);
        box-shadow: 0 4px 20px rgba(212, 175, 55, 0.2);
      }

      .message-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--border-light);
      }

      .message-date {
        color: #666;
        font-size: 0.95rem;
      }

      .message-content {
        color: var(--text-dark);
        line-height: 1.9;
        margin-bottom: 20px;
        font-size: 1.15rem;
        font-weight: 500;
      }

      .message-recording {
        background: white;
        padding: 25px;
        border-radius: 12px;
        margin-top: 20px;
        border: 1px solid var(--border-light);
      }

      .message-recording video,
      .message-recording audio {
        width: 100%;
        border-radius: 10px;
        margin-top: 15px;
      }

      .admin-comment-section {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 2px dashed var(--border-light);
      }

      .comment-form {
        display: grid;
        gap: 15px;
      }

      .comment-form textarea {
        width: 100%;
        padding: 18px;
        border: 2px solid var(--border-light);
        border-radius: 12px;
        font-family: "Cairo", sans-serif;
        resize: vertical;
        min-height: 100px;
        font-size: 1.05rem;
        transition: all 0.3s ease;
      }

      .comment-form textarea:focus {
        outline: none;
        border-color: var(--primary-gold);
      }

      .btn-send-message {
        background: var(--primary-gold);
        color: var(--dark-green);
        padding: 14px 28px;
        border: none;
        border-radius: 12px;
        font-weight: 700;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-send-message:hover {
        background: var(--accent-gold);
        transform: translateY(-2px);
      }

      .empty-state {
        text-align: center;
        padding: 60px 30px;
        color: #999;
      }

      .empty-state .icon {
        font-size: 5rem;
        margin-bottom: 20px;
        opacity: 0.5;
      }

      .empty-state p {
        font-size: 1.2rem;
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 3000;
      }

      .loading-spinner {
        text-align: center;
        color: white;
      }

      .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid var(--primary-gold);
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      @media (max-width: 768px) {
        .card {
          padding: 30px 25px;
        }

        .logo {
          width: 130px;
          height: 130px;
        }

        h1 {
          font-size: 2.4rem;
        }

        .subtitle {
          font-size: 1.2rem;
        }

        .recording-controls {
          grid-template-columns: 1fr;
        }

        .choose-type {
          grid-template-columns: 1fr;
        }

        .logout-btn {
          top: 15px;
          left: 15px;
          padding: 10px 20px;
          font-size: 0.95rem;
        }
      }

      .confirm-dialog {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
      }

      .confirm-dialog-content {
        background: white;
        padding: 40px;
        border-radius: 16px;
        max-width: 500px;
        width: 90%;
        text-align: center;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      }

      .confirm-dialog h3 {
        color: var(--dark-green);
        font-size: 1.5rem;
        margin-bottom: 20px;
      }

      .confirm-dialog p {
        color: var(--text-dark);
        font-size: 1.1rem;
        margin-bottom: 30px;
        line-height: 1.6;
      }

      .confirm-dialog-buttons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .confirm-dialog-buttons button {
        padding: 15px;
        border: none;
        border-radius: 10px;
        font-size: 1.05rem;
        font-weight: 700;
        font-family: "Cairo", sans-serif;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-confirm-delete {
        background: #dc2626;
        color: white;
      }

      .btn-confirm-delete:hover {
        background: #b91c1c;
      }

      .btn-cancel-delete {
        background: #e5e5e5;
        color: var(--text-dark);
      }

      .btn-cancel-delete:hover {
        background: #d4d4d4;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="logo">
          <img src="360_F_498618110_CmzpqAOH4xxhBFqXKEx5cOwYhvHpnmDH.jpg" alt="Ø´Ø¹Ø§Ø± Ø±Ù…Ø¶Ø§Ù†" />
        </div>
        <h1>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø­ÙØ¸ Ø¬Ø²Ø¡ Ø¹Ù…</h1>
        <p class="subtitle">Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ 1446</p>
      </div>

      <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <div id="homePage" class="card">
        <div class="info-box">
          <h3>âœ¨ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø­ÙØ¸ Ø¬Ø²Ø¡ Ø¹Ù…</h3>
          <p>
            Ø³Ø¬Ù‘Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ´Ø§Ø±Ùƒ ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨ØªØ³Ø¬ÙŠÙ„ ØªÙ„Ø§ÙˆØªÙƒ Ù„Ø¬Ø²Ø¡ Ø¹Ù…. Ù†Ø³Ø£Ù„ Ø§Ù„Ù„Ù‡ Ø£Ù†
            ÙŠØªÙ‚Ø¨Ù„ Ù…Ù†Ø§ ÙˆÙ…Ù†ÙƒÙ… ØµØ§Ù„Ø­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„.
          </p>
        </div>

        <button
          type="button"
          class="btn btn-primary"
          onclick="showRegisterPage()"
          style="margin-bottom: 15px"
        >
          ğŸ†• ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
        </button>

        <button
          type="button"
          class="btn btn-secondary"
          onclick="showLoginPage()"
        >
          ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
        </button>

        <div
          style="
            margin-top: 30px;
            text-align: center;
            padding-top: 25px;
            border-top: 2px solid var(--border-light);
          "
        >
          <p style="color: #666; margin-bottom: 15px; font-size: 1.05rem;">Ù‡Ù„ Ø£Ù†Øª Ø§Ù„Ù…Ø¯ÙŠØ±ØŸ</p>
          <button
            type="button"
            class="btn btn-secondary"
            onclick="showAdminLogin()"
          >
            Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±
          </button>
        </div>
      </div>

      <!-- ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
      <div id="registerPage" class="card hidden">
        <div class="info-box">
          <h3>âœ¨ ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
          <p>Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</p>
        </div>

        <form id="registerForm">
          <div class="form-group">
            <label>Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ… *</label>
            <input
              type="text"
              id="participantName"
              required
              placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ"
            />
          </div>

          <div class="form-group">
            <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
            <input
              type="password"
              id="password"
              required
              placeholder="Ø§Ø®ØªØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¨Ø³ÙŠØ·Ø©"
            />
          </div>

          <button type="submit" class="btn btn-primary">
            Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ğŸŒŸ
          </button>
        </form>

        <div style="margin-top: 25px; text-align: center">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="showHomePage()"
          >
            Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </button>
        </div>
      </div>

      <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† -->
      <div id="loginPage" class="card hidden">
        <h2
          style="
            color: var(--dark-green);
            margin-bottom: 30px;
            text-align: center;
            font-size: 2rem;
          "
        >
          ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        </h2>

        <div id="loginError" class="error-message hidden"></div>

        <form id="loginForm">
          <div class="form-group">
            <label>Ø§Ø³Ù…Ùƒ</label>
            <input
              type="text"
              id="loginName"
              required
              placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ"
            />
          </div>

          <div class="form-group">
            <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input
              type="password"
              id="loginPassword"
              required
              placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
            />
          </div>

          <button type="submit" class="btn btn-primary">Ø¯Ø®ÙˆÙ„ ğŸ”“</button>
        </form>

        <div style="margin-top: 25px; text-align: center">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="showHomePage()"
          >
            Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </button>
        </div>
      </div>

      <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ø¯ÙŠØ± -->
      <div id="adminLoginPage" class="card hidden">
        <h2
          style="
            color: var(--dark-green);
            margin-bottom: 30px;
            text-align: center;
            font-size: 2rem;
          "
        >
          Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±
        </h2>

        <div id="adminError" class="error-message hidden"></div>

        <form id="adminLoginForm">
          <div class="form-group">
            <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±</label>
            <input
              type="password"
              id="adminPassword"
              required
              placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
            />
          </div>

          <button type="submit" class="btn btn-primary">Ø¯Ø®ÙˆÙ„</button>
        </form>

        <div style="margin-top: 25px; text-align: center">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="showHomePage()"
          >
            Ø§Ù„Ø¹ÙˆØ¯Ø©
          </button>
        </div>
      </div>

      <!-- ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ) -->
      <div id="recordPage" class="card hidden">
        <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

        <div class="info-box">
          <h3>Ù…Ø±Ø­Ø¨Ø§Ù‹ <span id="welcomeName"></span>! ğŸŒ™</h3>
          <p>Ø³Ø¬Ù‘Ù„ ØªÙ„Ø§ÙˆØªÙƒ Ù„Ø¬Ø²Ø¡ Ø¹Ù…. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ Ø£Ùˆ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.</p>
        </div>

        <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
        <div style="display: flex; gap: 15px; margin-bottom: 30px">
          <button
            class="btn btn-secondary"
            onclick="showRecordingSection()"
            style="flex: 1"
          >
            ğŸ¤ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª
          </button>
          <button
            class="btn btn-secondary"
            onclick="showMessagesSection()"
            style="flex: 1; position: relative"
          >
            ğŸ“¬ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            <span id="unreadBadge" class="unread-badge hidden"></span>
          </button>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
        <div id="recordingSection">
          <div class="choose-type">
            <div
              class="type-option selected"
              onclick="selectRecordingType('audio')"
            >
              <div class="icon">ğŸ¤</div>
              <h3>ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ</h3>
            </div>
            <div class="type-option" onclick="selectRecordingType('video')">
              <div class="icon">ğŸ¥</div>
              <h3>ØªØ³Ø¬ÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ</h3>
            </div>
          </div>

          <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø­ÙŠØ© Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ -->
          <div id="livePreview" class="live-preview hidden">
            <div class="live-preview-label">
              <span class="live-indicator"></span>
              <span id="previewLabelText">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</span>
            </div>
            <video id="liveVideo" autoplay muted playsinline></video>
          </div>

          <div>
            <button class="btn btn-record" onclick="startRecording()">
              <span id="recordBtnText">ğŸ”´ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</span>
            </button>

            <div class="timer hidden" id="recordTimer">00:00</div>

            <div class="recording-controls hidden" id="recordingControls">
              <button class="btn btn-stop" onclick="stopRecording()">
                â¹ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„
              </button>
              <button class="btn btn-secondary" onclick="cancelRecording()">
                âŒ Ø¥Ù„ØºØ§Ø¡
              </button>
            </div>

            <div id="recordingPreview" class="recording-preview hidden">
              <h3
                style="
                  color: var(--dark-green);
                  margin-bottom: 15px;
                  font-weight: 700;
                  font-size: 1.3rem;
                "
              >
                Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
              </h3>
              <div id="previewMedia"></div>
              <div
                style="
                  display: grid;
                  grid-template-columns: 1fr 1fr;
                  gap: 15px;
                  margin-top: 20px;
                "
              >
                <button class="btn btn-primary" onclick="saveRecording()">
                  ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                </button>
                <button class="btn btn-secondary" onclick="cancelRecording()">
                  ğŸ”„ ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                </button>
              </div>
            </div>
          </div>

          <div style="margin-top: 40px">
            <h3
              style="
                color: var(--dark-green);
                margin-bottom: 20px;
                font-weight: 700;
                font-size: 1.4rem;
              "
            >
              ØªØ³Ø¬ÙŠÙ„Ø§ØªÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            </h3>
            <div id="myRecordingsList"></div>
          </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
        <div id="messagesSection" class="hidden">
          <h3 style="color: var(--dark-green); margin-bottom: 25px; font-size: 1.5rem;">
            ğŸ“¬ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø¯ÙŠØ±
          </h3>
          <div id="messagesList"></div>
        </div>
      </div>

      <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± -->
      <div id="adminPage" class="card hidden">
        <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

        <h2
          style="
            color: var(--dark-green);
            margin-bottom: 35px;
            text-align: center;
            font-size: 2rem;
          "
        >
          Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±
        </h2>

        <div class="admin-stats">
          <div class="stat-card">
            <div class="number" id="totalParticipants">0</div>
            <div class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</div>
          </div>
          <div class="stat-card">
            <div class="number" id="totalRecordings">0</div>
            <div class="label">Ø¹Ø¯Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</div>
          </div>
          <div class="stat-card">
            <div class="number" id="totalMessages">0</div>
            <div class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø©</div>
          </div>
        </div>

        <div id="participantsList"></div>
      </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
      import { getDatabase, ref, set, get, push, onValue, remove, update } from 'https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js';

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyAfhQL5spF3KcrbngSzunLaHT_7cieHkUk",
        authDomain: "opject-e223d.firebaseapp.com",
        databaseURL: "https://opject-e223d-default-rtdb.firebaseio.com/",
        projectId: "opject-e223d",
        storageBucket: "opject-e223d.firebasestorage.app",
        messagingSenderId: "607939195786",
        appId: "1:607939195786:web:c264710387d50fc2990e73"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);

      // Make Firebase accessible globally
      window.db = database;
      window.dbRef = ref;
      window.dbSet = set;
      window.dbGet = get;
      window.dbPush = push;
      window.dbOnValue = onValue;
      window.dbRemove = remove;
      window.dbUpdate = update;
      window.firebaseInitialized = true;

      console.log("âœ… Firebase initialized successfully!");
      console.log("ğŸ“Š Database URL:", firebaseConfig.databaseURL);
    </script>

    <script>
      let currentUser = null;
      let isAdmin = false;
      let mediaRecorder = null;
      let recordedChunks = [];
      let recordingType = "audio";
      let timerInterval = null;
      let recordingStartTime = null;
      let previewStream = null;

      window.onload = function () {
        // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Firebase Ø«Ù… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©
        const checkFirebase = setInterval(() => {
          if (window.firebaseInitialized && window.db) {
            clearInterval(checkFirebase);
            console.log("âœ… Firebase ready, loading session...");
            loadCurrentSession();
          }
        }, 100);

        // Ù…Ù‡Ù„Ø© Ø²Ù…Ù†ÙŠØ© Ø¥Ø°Ø§ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Firebase
        setTimeout(() => {
          clearInterval(checkFirebase);
          if (!window.db) {
            console.error("âŒ Firebase failed to initialize");
            alert("âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.\n\nØ§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù†:\n1. Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª\n2. ØªÙØ¹ÙŠÙ„ Realtime Database ÙÙŠ Firebase Console\n\nØ«Ù… Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.");
            showHomePage();
          }
        }, 5000);
      };

      function showLoading() {
        const existing = document.getElementById('loadingOverlay');
        if (existing) return;
        
        const overlay = document.createElement('div');
        overlay.className = 'loading-overlay';
        overlay.id = 'loadingOverlay';
        overlay.innerHTML = `
          <div class="loading-spinner">
            <div class="spinner"></div>
            <p style="font-size: 1.2rem; font-weight: 600;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
          </div>
        `;
        document.body.appendChild(overlay);
      }

      function hideLoading() {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) {
          overlay.remove();
        }
      }

      async function loadCurrentSession() {
        const session = localStorage.getItem("currentSession");
        if (session) {
          const data = JSON.parse(session);
          if (data.isAdmin) {
            isAdmin = true;
            showAdminPage();
          } else {
            showLoading();
            try {
              const snapshot = await Promise.race([
                window.dbGet(window.dbRef(window.db, 'participants/' + data.userId)),
                new Promise((_, reject) => setTimeout(() => reject(new Error('timeout')), 10000))
              ]);
              
              hideLoading();
              if (snapshot.exists()) {
                currentUser = { id: data.userId, ...snapshot.val() };
                showRecordPage();
              } else {
                localStorage.removeItem("currentSession");
                showHomePage();
              }
            } catch (error) {
              hideLoading();
              console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©:", error);
              localStorage.removeItem("currentSession");
              alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
              showHomePage();
            }
          }
        } else {
          showHomePage();
        }
      }

      function saveSession() {
        const session = isAdmin
          ? { isAdmin: true }
          : { isAdmin: false, userId: currentUser.id };
        localStorage.setItem("currentSession", JSON.stringify(session));
      }

      function showHomePage() {
        hideAllPages();
        document.getElementById("homePage").classList.remove("hidden");
      }

      function showRegisterPage() {
        hideAllPages();
        document.getElementById("registerPage").classList.remove("hidden");
      }

      function showLoginPage() {
        hideAllPages();
        document.getElementById("loginPage").classList.remove("hidden");
      }

      function showAdminLogin() {
        hideAllPages();
        document.getElementById("adminLoginPage").classList.remove("hidden");
      }

      function showRecordPage() {
        hideAllPages();
        document.getElementById("recordPage").classList.remove("hidden");
        document.getElementById("welcomeName").textContent = currentUser.name;
        showRecordingSection();
        loadMyRecordings();
        updateUnreadBadge();
      }

      function showAdminPage() {
        hideAllPages();
        document.getElementById("adminPage").classList.remove("hidden");
        loadAdminData();
      }

      function hideAllPages() {
        document.getElementById("homePage").classList.add("hidden");
        document.getElementById("registerPage").classList.add("hidden");
        document.getElementById("loginPage").classList.add("hidden");
        document.getElementById("adminLoginPage").classList.add("hidden");
        document.getElementById("recordPage").classList.add("hidden");
        document.getElementById("adminPage").classList.add("hidden");
      }

      function showRecordingSection() {
        document.getElementById("recordingSection").classList.remove("hidden");
        document.getElementById("messagesSection").classList.add("hidden");
        
        if (recordingType === "video" && !previewStream) {
          startVideoPreview();
        }
      }

      async function showMessagesSection() {
        document.getElementById("recordingSection").classList.add("hidden");
        document.getElementById("messagesSection").classList.remove("hidden");
        
        stopVideoPreview();
        
        await loadMessages();
        await markMessagesAsRead();
      }

      async function updateUnreadBadge() {
        const snapshot = await window.dbGet(window.dbRef(window.db, 'messages'));
        let unreadCount = 0;
        
        if (snapshot.exists()) {
          const messages = snapshot.val();
          Object.values(messages).forEach(msg => {
            if (msg.participantId === currentUser.id && !msg.read) {
              unreadCount++;
            }
          });
        }

        const badge = document.getElementById("unreadBadge");
        if (unreadCount > 0) {
          badge.textContent = unreadCount;
          badge.classList.remove("hidden");
        } else {
          badge.classList.add("hidden");
        }
      }

      async function markMessagesAsRead() {
        const snapshot = await window.dbGet(window.dbRef(window.db, 'messages'));
        
        if (snapshot.exists()) {
          const messages = snapshot.val();
          const updates = {};
          
          Object.entries(messages).forEach(([msgId, msg]) => {
            if (msg.participantId === currentUser.id && !msg.read) {
              updates[`messages/${msgId}/read`] = true;
            }
          });

          if (Object.keys(updates).length > 0) {
            await window.dbUpdate(window.dbRef(window.db), updates);
          }
        }
        
        updateUnreadBadge();
      }

      async function loadMessages() {
        const snapshot = await window.dbGet(window.dbRef(window.db, 'messages'));
        const listDiv = document.getElementById("messagesList");

        if (!snapshot.exists()) {
          listDiv.innerHTML = `
            <div class="empty-state">
              <div class="icon">ğŸ“­</div>
              <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯</p>
            </div>
          `;
          return;
        }

        const messages = [];
        snapshot.forEach(child => {
          const msg = child.val();
          if (msg.participantId === currentUser.id) {
            messages.push({ id: child.key, ...msg });
          }
        });

        if (messages.length === 0) {
          listDiv.innerHTML = `
            <div class="empty-state">
              <div class="icon">ğŸ“­</div>
              <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯</p>
            </div>
          `;
          return;
        }

        messages.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        let html = '';
        for (const msg of messages) {
          let recordingHtml = '';
          if (msg.recordingId && currentUser.recordings) {
            const recording = currentUser.recordings.find(r => r.id === msg.recordingId);
            if (recording) {
              recordingHtml = `
                <div class="message-recording">
                  <p style="color: var(--dark-green); font-weight: 600; margin-bottom: 10px;">
                    Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù†ÙŠ - ${recording.type === "video" ? "ÙÙŠØ¯ÙŠÙˆ ğŸ¥" : "ØµÙˆØª ğŸ¤"}
                  </p>
                  ${recording.type === "video" 
                    ? `<video controls src="${recording.data}"></video>`
                    : `<audio controls src="${recording.data}"></audio>`
                  }
                </div>
              `;
            }
          }

          html += `
            <div class="message-item ${!msg.read ? "unread" : ""}">
              <div class="message-header">
                <span style="color: var(--primary-gold); font-weight: 700;">âœ‰ï¸ Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ø¯ÙŠØ±</span>
                <span class="message-date">${new Date(msg.timestamp).toLocaleDateString("ar-SA")} - ${new Date(msg.timestamp).toLocaleTimeString("ar-SA", { hour: "2-digit", minute: "2-digit" })}</span>
              </div>
              <div class="message-content">${msg.message}</div>
              ${recordingHtml}
            </div>
          `;
        }

        listDiv.innerHTML = html;
      }

      document.getElementById("registerForm").onsubmit = async function (e) {
        e.preventDefault();

        const name = document.getElementById("participantName").value.trim();
        const password = document.getElementById("password").value;
        
        if (!name || !password) {
          alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!");
          return;
        }

        showLoading();
        
        try {
          const snapshot = await window.dbGet(window.dbRef(window.db, 'participants'));
          
          if (snapshot.exists()) {
            const participants = snapshot.val();
            const exists = Object.values(participants).some(p => p.name === name);
            
            if (exists) {
              hideLoading();
              alert("Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹! Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ø¢Ø®Ø± Ø£Ùˆ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.");
              return;
            }
          }

          const participantId = Date.now().toString();
          const participant = {
            name: name,
            password: password,
            registeredAt: new Date().toISOString(),
            recordings: []
          };

          await window.dbSet(window.dbRef(window.db, 'participants/' + participantId), participant);

          currentUser = { id: participantId, ...participant };
          saveSession();
          hideLoading();
          showRecordPage();
        } catch (error) {
          hideLoading();
          console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:", error);
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.\n\nØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£: " + error.message);
        }
      };

      document.getElementById("loginForm").onsubmit = async function (e) {
        e.preventDefault();

        const name = document.getElementById("loginName").value;
        const password = document.getElementById("loginPassword").value;

        showLoading();
        const snapshot = await window.dbGet(window.dbRef(window.db, 'participants'));
        hideLoading();

        if (snapshot.exists()) {
          const participants = snapshot.val();
          let foundUser = null;
          let foundId = null;

          Object.entries(participants).forEach(([id, p]) => {
            if (p.name === name && p.password === password) {
              foundUser = p;
              foundId = id;
            }
          });

          if (foundUser) {
            currentUser = { id: foundId, ...foundUser };
            saveSession();
            showRecordPage();
            return;
          }
        }

        document.getElementById("loginError").textContent = "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!";
        document.getElementById("loginError").classList.remove("hidden");
        setTimeout(() => {
          document.getElementById("loginError").classList.add("hidden");
        }, 3000);
      };

      document.getElementById("adminLoginForm").onsubmit = function (e) {
        e.preventDefault();

        const password = document.getElementById("adminPassword").value;

        if (password === "Qur@n2025#Admin$Ramadan") {
          isAdmin = true;
          saveSession();
          showAdminPage();
        } else {
          document.getElementById("adminError").textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!";
          document.getElementById("adminError").classList.remove("hidden");
          setTimeout(() => {
            document.getElementById("adminError").classList.add("hidden");
          }, 3000);
        }
      };

      function logout() {
        stopVideoPreview();
        localStorage.removeItem("currentSession");
        currentUser = null;
        isAdmin = false;
        showHomePage();
      }

      function selectRecordingType(type) {
        recordingType = type;
        document.querySelectorAll(".type-option").forEach((el) => el.classList.remove("selected"));
        event.target.closest(".type-option").classList.add("selected");
        
        if (type === "video") {
          startVideoPreview();
        } else {
          stopVideoPreview();
        }
      }

      async function startVideoPreview() {
        try {
          if (previewStream) return;
          
          const stream = await navigator.mediaDevices.getUserMedia({ 
            video: true, 
            audio: false 
          });
          
          previewStream = stream;
          const liveVideo = document.getElementById("liveVideo");
          liveVideo.srcObject = stream;
          document.getElementById("livePreview").classList.remove("hidden");
        } catch (err) {
          console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§:", err);
          alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§: " + err.message);
        }
      }

      function stopVideoPreview() {
        if (previewStream) {
          previewStream.getTracks().forEach((track) => track.stop());
          previewStream = null;
          const liveVideo = document.getElementById("liveVideo");
          if (liveVideo.srcObject) {
            liveVideo.srcObject = null;
          }
          document.getElementById("livePreview").classList.add("hidden");
        }
      }

      async function startRecording() {
        try {
          let stream;
          
          if (recordingType === "video") {
            if (previewStream) {
              const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
              stream = new MediaStream([
                ...previewStream.getVideoTracks(),
                ...audioStream.getAudioTracks()
              ]);
            } else {
              stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
              previewStream = stream;
              const liveVideo = document.getElementById("liveVideo");
              liveVideo.srcObject = stream;
              document.getElementById("livePreview").classList.remove("hidden");
            }
          } else {
            stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          }

          recordedChunks = [];
          mediaRecorder = new MediaRecorder(stream);

          mediaRecorder.ondataavailable = function (e) {
            if (e.data.size > 0) {
              recordedChunks.push(e.data);
            }
          };

          mediaRecorder.onstop = function () {
            if (recordingType === "audio") {
              stream.getTracks().forEach((track) => track.stop());
            }
            showPreview();
          };

          mediaRecorder.start();

          document.querySelector(".btn-record").classList.add("recording");
          document.getElementById("recordBtnText").textContent = "âº Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...";
          document.getElementById("recordTimer").classList.remove("hidden");
          document.getElementById("recordingControls").classList.remove("hidden");
          
          if (recordingType === "video") {
            document.getElementById("livePreview").classList.add("recording");
            document.getElementById("previewLabelText").textContent = "ğŸ”´ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„";
          }

          recordingStartTime = Date.now();
          timerInterval = setInterval(updateTimer, 1000);
        } catch (err) {
          alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§/Ø§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†: " + err.message);
        }
      }

      function updateTimer() {
        const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
        const minutes = Math.floor(elapsed / 60).toString().padStart(2, "0");
        const seconds = (elapsed % 60).toString().padStart(2, "0");
        document.getElementById("recordTimer").textContent = `${minutes}:${seconds}`;
      }

      function stopRecording() {
        if (mediaRecorder && mediaRecorder.state !== "inactive") {
          mediaRecorder.stop();
          clearInterval(timerInterval);
        }
      }

      function cancelRecording() {
        if (mediaRecorder && mediaRecorder.state !== "inactive") {
          mediaRecorder.stop();
        }

        document.getElementById("livePreview").classList.remove("recording");
        document.getElementById("previewLabelText").textContent = "Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§";

        if (recordingType === "audio") {
          const liveVideo = document.getElementById("liveVideo");
          if (liveVideo.srcObject) {
            liveVideo.srcObject.getTracks().forEach((track) => track.stop());
            liveVideo.srcObject = null;
          }
          document.getElementById("livePreview").classList.add("hidden");
        }

        clearInterval(timerInterval);
        recordedChunks = [];

        document.querySelector(".btn-record").classList.remove("recording");
        document.getElementById("recordBtnText").textContent = "ğŸ”´ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„";
        document.getElementById("recordTimer").classList.add("hidden");
        document.getElementById("recordTimer").textContent = "00:00";
        document.getElementById("recordTimer").style.color = "var(--dark-green)";
        document.getElementById("recordingControls").classList.add("hidden");
        document.getElementById("recordingPreview").classList.add("hidden");
      }

      function showPreview() {
        const blob = new Blob(recordedChunks, {
          type: recordingType === "video" ? "video/webm" : "audio/webm",
        });

        const url = URL.createObjectURL(blob);
        const previewDiv = document.getElementById("previewMedia");

        if (recordingType === "video") {
          previewDiv.innerHTML = `<video controls src="${url}"></video>`;
        } else {
          previewDiv.innerHTML = `<audio controls src="${url}"></audio>`;
        }

        document.getElementById("recordingPreview").classList.remove("hidden");
        document.querySelector(".btn-record").classList.add("hidden");
        document.getElementById("recordingControls").classList.add("hidden");
      }

      // ØªØ­ÙˆÙŠÙ„ Blob Ø¥Ù„Ù‰ Base64
      function blobToBase64(blob) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onloadend = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(blob);
        });
      }

      async function saveRecording() {
        showLoading();
        
        try {
          const blob = new Blob(recordedChunks, {
            type: recordingType === "video" ? "video/webm" : "audio/webm",
          });

          // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù€ blob Ù„Ù€ base64
          const base64Data = await blobToBase64(blob);

          const recordingId = Date.now().toString();
          const recording = {
            id: recordingId,
            type: recordingType,
            data: base64Data, // Ø­ÙØ¸ ÙƒÙ€ base64 Ø¨Ø¯Ù„ URL
            timestamp: new Date().toISOString(),
          };

          const recordings = currentUser.recordings || [];
          recordings.push(recording);

          await window.dbUpdate(window.dbRef(window.db), {
            [`participants/${currentUser.id}/recordings`]: recordings
          });

          currentUser.recordings = recordings;

          hideLoading();
          alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! âœ…");
          
          document.getElementById("livePreview").classList.remove("recording");
          document.getElementById("previewLabelText").textContent = "Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§";
          
          clearInterval(timerInterval);
          recordedChunks = [];

          document.querySelector(".btn-record").classList.remove("recording");
          document.querySelector(".btn-record").classList.remove("hidden");
          document.getElementById("recordBtnText").textContent = "ğŸ”´ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„";
          document.getElementById("recordTimer").classList.add("hidden");
          document.getElementById("recordTimer").textContent = "00:00";
          document.getElementById("recordTimer").style.color = "var(--dark-green)";
          document.getElementById("recordingControls").classList.add("hidden");
          document.getElementById("recordingPreview").classList.add("hidden");
          
          loadMyRecordings();
        } catch (error) {
          hideLoading();
          console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:", error);
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ØªØ³Ø¬ÙŠÙ„!\n\nØ§Ù„Ø®Ø·Ø£: " + error.message + "\n\nÙ‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ø³Ø¨Ø¨:\n- Ø­Ø¬Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹\n- Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª\n\nØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø¬ÙˆØ¯Ø© Ø£Ù‚Ù„.");
        }
      }

      function loadMyRecordings() {
        const listDiv = document.getElementById("myRecordingsList");

        if (!currentUser.recordings || currentUser.recordings.length === 0) {
          listDiv.innerHTML = '<div class="empty-state"><div class="icon">ğŸ™ï¸</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯</p></div>';
          return;
        }

        listDiv.innerHTML = currentUser.recordings
          .map((rec, index) => `
            <div class="recording-item">
              <div class="recording-header">
                <div class="recording-info">
                  <p style="color: var(--dark-green); font-weight: 700; font-size: 1.2rem; margin-bottom: 8px;">
                    Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ${index + 1} - ${rec.type === "video" ? "ÙÙŠØ¯ÙŠÙˆ ğŸ¥" : "ØµÙˆØª ğŸ¤"}
                  </p>
                  <p style="color: #666; font-size: 1rem;">
                    ${new Date(rec.timestamp).toLocaleDateString("ar-SA")} - 
                    ${new Date(rec.timestamp).toLocaleTimeString("ar-SA", { hour: "2-digit", minute: "2-digit" })}
                  </p>
                </div>
                <button class="delete-btn" onclick="confirmDeleteRecording('${rec.id}')" title="Ø­Ø°Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„">â‹®</button>
              </div>
              ${rec.type === "video" 
                ? `<video controls src="${rec.data}"></video>`
                : `<audio controls src="${rec.data}"></audio>`
              }
            </div>
          `).join("");
      }

      function confirmDeleteRecording(recordingId) {
        const dialog = document.createElement("div");
        dialog.className = "confirm-dialog";
        dialog.innerHTML = `
          <div class="confirm-dialog-content">
            <h3>âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3>
            <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ØŸ<br>Ø³ÙŠØªÙ… Ø­Ø°ÙÙ‡ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ÙˆÙ„Ù† ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ±Ø¬Ø§Ø¹Ù‡.</p>
            <div class="confirm-dialog-buttons">
              <button class="btn-confirm-delete" onclick="deleteRecording('${recordingId}')">ğŸ—‘ï¸ Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ</button>
              <button class="btn-cancel-delete" onclick="closeConfirmDialog()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
          </div>
        `;
        document.body.appendChild(dialog);
      }

      function closeConfirmDialog() {
        const dialog = document.querySelector(".confirm-dialog");
        if (dialog) {
          dialog.remove();
        }
      }

      async function deleteRecording(recordingId) {
        showLoading();

        const recordings = currentUser.recordings.filter(r => r.id !== recordingId);
        
        await window.dbUpdate(window.dbRef(window.db), {
          [`participants/${currentUser.id}/recordings`]: recordings
        });

        const messagesSnapshot = await window.dbGet(window.dbRef(window.db, 'messages'));
        if (messagesSnapshot.exists()) {
          const updates = {};
          messagesSnapshot.forEach(child => {
            const msg = child.val();
            if (msg.recordingId === recordingId) {
              updates[`messages/${child.key}`] = null;
            }
          });

          if (Object.keys(updates).length > 0) {
            await window.dbUpdate(window.dbRef(window.db), updates);
          }
        }

        currentUser.recordings = recordings;

        hideLoading();
        closeConfirmDialog();
        loadMyRecordings();
        updateUnreadBadge();

        alert("ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! âœ…");
      }

      async function sendMessage(participantId, recordingId, message) {
        const messagesRef = window.dbRef(window.db, 'messages');
        const newMessageRef = window.dbPush(messagesRef);

        const newMessage = {
          participantId: participantId,
          recordingId: recordingId,
          message: message,
          timestamp: new Date().toISOString(),
          read: false,
        };

        await window.dbSet(newMessageRef, newMessage);
        return newMessage;
      }

      async function loadAdminData() {
        showLoading();

        const participantsSnapshot = await window.dbGet(window.dbRef(window.db, 'participants'));
        const messagesSnapshot = await window.dbGet(window.dbRef(window.db, 'messages'));

        hideLoading();

        let participants = [];
        let totalRecordings = 0;

        if (participantsSnapshot.exists()) {
          participantsSnapshot.forEach(child => {
            const p = { id: child.key, ...child.val() };
            participants.push(p);
            totalRecordings += (p.recordings || []).length;
          });
        }

        let totalMessages = 0;
        if (messagesSnapshot.exists()) {
          messagesSnapshot.forEach(() => totalMessages++);
        }

        document.getElementById("totalParticipants").textContent = participants.length;
        document.getElementById("totalRecordings").textContent = totalRecordings;
        document.getElementById("totalMessages").textContent = totalMessages;

        const listDiv = document.getElementById("participantsList");

        if (participants.length === 0) {
          listDiv.innerHTML = '<div class="empty-state"><div class="icon">ğŸ‘¥</div><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø¨Ø¹Ø¯</p></div>';
          return;
        }

        listDiv.innerHTML = participants
          .map(participant => `
            <div class="participant-item">
              <div class="participant-info">
                <h3>${participant.name}</h3>
                <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</strong> ${new Date(participant.registeredAt).toLocaleDateString("ar-SA")}</p>
                <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª:</strong> ${(participant.recordings || []).length}</p>
              </div>
              
              ${(participant.recordings || []).length > 0 ? `
                <div class="recordings-list">
                  <h4 style="color: var(--dark-green); margin-bottom: 20px; font-weight: 700; font-size: 1.3rem;">Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª:</h4>
                  ${participant.recordings.map((rec, index) => `
                    <div class="recording-item">
                      <p style="color: var(--dark-green); font-weight: 700; font-size: 1.2rem; margin-bottom: 8px;">
                        Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ${index + 1} - ${rec.type === "video" ? "ÙÙŠØ¯ÙŠÙˆ ğŸ¥" : "ØµÙˆØª ğŸ¤"}
                      </p>
                      <p style="color: #666; font-size: 1rem; margin-bottom: 15px;">
                        ${new Date(rec.timestamp).toLocaleDateString("ar-SA")} - 
                        ${new Date(rec.timestamp).toLocaleTimeString("ar-SA", { hour: "2-digit", minute: "2-digit" })}
                      </p>
                      ${rec.type === "video" 
                        ? `<video controls src="${rec.data}" style="width: 100%; max-height: 450px; object-fit: contain;"></video>`
                        : `<audio controls src="${rec.data}" style="width: 100%;"></audio>`
                      }
                      
                      <div class="admin-comment-section">
                        <h4 style="color: var(--dark-green); margin-bottom: 15px; font-weight: 700; font-size: 1.2rem;">ğŸ’¬ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø´Ø§Ø±Ùƒ</h4>
                        <div class="comment-form">
                          <textarea id="comment_${participant.id}_${rec.id}" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...

Ø£Ù…Ø«Ù„Ø©:
âœ… Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡ØŒ ØªÙ„Ø§ÙˆØ© Ø¬Ù…ÙŠÙ„Ø© ÙˆØ£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹!
ğŸ“ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ Ø¥Ù„Ù‰ Ø£Ø­ÙƒØ§Ù… Ø§Ù„ØªØ¬ÙˆÙŠØ¯ ÙÙŠ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø®Ø§Ù…Ø³Ø©
ğŸ¯ Ø±Ø§Ø¦Ø¹ Ø¬Ø¯Ø§Ù‹! Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø¥ØªÙ‚Ø§Ù†
ğŸ’¡ Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ ØµØºÙŠØ± ÙÙŠ Ø§Ù„Ù†Ø·Ù‚ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"></textarea>
                          <button class="btn-send-message" onclick="sendCommentToParticipant('${participant.id}', '${rec.id}')">
                            ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                          </button>
                        </div>
                      </div>
                    </div>
                  `).join("")}
                </div>
              ` : '<div class="empty-state" style="padding: 30px;"><p style="color: #999; font-style: italic;">Ù„Ù… ÙŠÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯</p></div>'}
            </div>
          `).join("");
      }

      async function sendCommentToParticipant(participantId, recordingId) {
        const textarea = document.getElementById(`comment_${participantId}_${recordingId}`);
        const message = textarea.value.trim();

        if (!message) {
          alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø©!");
          return;
        }

        showLoading();
        await sendMessage(participantId, recordingId, message);
        hideLoading();

        textarea.value = "";
        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­! âœ…");
      }
    </script>
  </body>
</html>
